import{l as De,c as q,b as yt,t as bt,i as gt,s as kt,d as St,p as Ie,D as Ae,g as Ee,h as j,u as xt,r as Ct,j as wt,k as Rt,n as h,o as W,q as Te,f as b,v as l,w as c,x as T,y as e,z as Qt,a as p,A as Mt,B as n,C as w,E as qe,F as ne,G as At,m as Et}from"./disclose-version-UNGnYCer.js";import{i as R,Q as ze,s as U,e as Fe,a as He,b as le,S as Tt}from"./index-B2xt4Leg.js";function Le(a,f,g=!1){if(a.multiple){if(f==null)return;if(!gt(f))return kt();for(var i of a.options)i.selected=f.includes(N(i));return}for(i of a.options){var m=N(i);if(St(m,f)){i.selected=!0;return}}(!g||f!==void 0)&&(a.selectedIndex=-1)}function qt(a){var f=new MutationObserver(()=>{Le(a,a.__value)});f.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),bt(()=>{f.disconnect()})}function zt(a,f,g=f){var i=new WeakSet,m=!0;De(a,"change",u=>{var y=u?"[selected]":":checked",_;if(a.multiple)_=[].map.call(a.querySelectorAll(y),N);else{var z=a.querySelector(y)??a.querySelector("option:not([disabled])");_=z&&N(z)}g(_),q!==null&&i.add(q)}),yt(()=>{var u=f();if(a===document.activeElement){var y=Ie??q;if(i.has(y))return}if(Le(a,u,m),m&&u===void 0){var _=a.querySelector(":checked");_!==null&&(u=N(_),g(u))}a.__value=u,m=!1}),qt(a)}function N(a){return"__value"in a?a.__value:a.value}function oe(a,f,g=f){var i=new WeakSet;De(a,"input",async m=>{Ae&&a.type==="checkbox"&&Ee();var u=m?a.defaultValue:a.value;if(u=ie(a)?ce(u):u,g(u),q!==null&&i.add(q),await j(),u!==(u=f())){var y=a.selectionStart,_=a.selectionEnd,z=a.value.length;if(a.value=u??"",_!==null){var x=a.value.length;y===_&&_===z&&x>z?(a.selectionStart=x,a.selectionEnd=x):(a.selectionStart=y,a.selectionEnd=Math.min(_,x))}}}),xt(f)==null&&a.value&&(g(ie(a)?ce(a.value):a.value),q!==null&&i.add(q)),Ct(()=>{Ae&&a.type==="checkbox"&&Ee();var m=f();if(a===document.activeElement){var u=Ie??q;if(i.has(u))return}ie(a)&&m===ce(a.value)||a.type==="date"&&!m&&!a.value||m!==a.value&&(a.value=m??"")})}function ie(a){var f=a.type;return f==="number"||f==="range"}function ce(a){return a===""?null:+a}var Ft=b('<div class="file-info"><p>‚úì File: <strong> </strong> </p> <p>Hash: <code> </code></p></div>'),Ht=b('<img class="svelte-1ecl6tu"/>'),Dt=b('<button class="qr-display svelte-1ecl6tu" type="button"></button>'),It=b('<img class="svelte-1ecl6tu"/>'),Lt=b('<button class="qr-display svelte-1ecl6tu" type="button"></button>'),Ot=b('<span class="recovery-mode svelte-1ecl6tu">(Recovery mode)</span>'),$t=b(" <!>",1),Bt=b('<button class="danger svelte-1ecl6tu">‚èπ Stop</button>'),Ut=b('<button type="button" class="primary svelte-1ecl6tu">‚ñ∂ Start Transmission</button>'),jt=b('<button class="svelte-1ecl6tu">üì∑ Scan Recovery QR</button>'),Nt=b('<button class="danger svelte-1ecl6tu">‚èπ Stop le scan</button>'),Pt=b('<div class="scanner-view svelte-1ecl6tu"><video width="400" height="300" style="display:block;" class="svelte-1ecl6tu"></video> <canvas width="400" height="300" style="display:none;"></canvas></div>',2),Vt=b('<p class="info svelte-1ecl6tu"> </p>'),Gt=b('<main class="svelte-1ecl6tu"><header class="card svelte-1ecl6tu"><h1>üì§ QR Code Sender</h1> <p class="field"><label for="fileInput" class="svelte-1ecl6tu">Select a file</label> <input id="fileInput" type="file" accept="*/*" class="svelte-1ecl6tu"/></p> <!> <details><summary>Transmission Parameters (advanced options)</summary> <div class="settings svelte-1ecl6tu"><p class="field"><label for="numberOfQRCodes" class="svelte-1ecl6tu">Nombre de QR codes simultan√©s:</label> <input id="numberOfQRCodes" type="number" min="1" max="9" step="1" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu">Afficher plusieurs QR codes √† la fois pour acc√©l√©rer le transfert</span></p> <p class="field"><label for="transmissionSpeed" class="svelte-1ecl6tu">Transmission speed (ms):</label> <input id="transmissionSpeed" type="number" min="100" max="5000" step="50" class="svelte-1ecl6tu"/></p> <p class="field"><label for="errorCorrectionLevel" class="svelte-1ecl6tu">Error correction level:</label> <select id="errorCorrectionLevel" class="svelte-1ecl6tu"><option> </option><option> </option><option> </option><option> </option></select></p> <p class="field"><label for="chunkSize" class="svelte-1ecl6tu">Chunk size (bytes):</label> <input id="chunkSize" type="number" min="500" step="100" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu"> </span></p></div></details></header> <section class="main-content svelte-1ecl6tu"><!> <div class="controls svelte-1ecl6tu"><p class="status svelte-1ecl6tu"><!></p> <!> <button type="button" class="secondary svelte-1ecl6tu">üîÑ Reset</button></div></section> <footer class="card svelte-1ecl6tu"><h2>Missing chunks recovery</h2> <p>Scan the recovery QR code displayed by the receiver</p> <!> <!> <!></footer></main>');function Jt(a,f){Rt(f,!0);const g={L:2953,M:2331,Q:1663,H:1273};let i=h(null),m=h(W([])),u=h(null),y=h(!1),_=h(0),z=h(""),x=h(W([])),k=h(void 0),S=h(void 0),O,F=h(!1),Q=h(W([])),D=h("all"),M=h(1400),Y=h(100),I=h("M"),L=h(1),A=h(0),K=W(new Set),$=h(""),X;function Z(){return g[e(I)]-23}function ee(){const t=Z();e(M)>t&&(n(M,t,!0),alert(`Chunk size adjusted to ${t} bytes to fit in QR code with ${e(I)} error correction.`))}async function Oe(t){const r=await t.arrayBuffer(),s=await crypto.subtle.digest("SHA-1",r);return new Uint8Array(s)}function te(t){return Array.from(t).map(r=>r.toString(16).padStart(2,"0")).join("")}async function ue(){if(!e(i))return;n(u,await Oe(e(i)),!0);const t=await e(i).arrayBuffer(),r=new Uint8Array(t);n(m,[],!0),n(A,Math.ceil(r.length/e(M)),!0);let s=1;e(A)>255&&(s=2),e(A)>65535&&(s=3);for(let v=0;v<e(A);v++){const o=v*e(M),d=Math.min(o+e(M),r.length),C=r.slice(o,d),H=new Uint8Array(20+s+C.length);H.set(e(u),0);for(let E=0;E<s;E++)H[20+E]=v>>8*(s-1-E)&255;H.set(C,20+s),e(m).push({binaryData:H,chunkIndex:v,fileName:e(i).name})}await $e()}async function $e(){const t={type:"fileInfo",fileHash:te(e(u)),fileName:e(i).name,fileSize:e(i).size,totalChunks:e(A),chunkSize:e(M)};try{n($,await ze.toDataURL(JSON.stringify(t),{errorCorrectionLevel:"M",margin:1,width:800}),!0)}catch(r){console.error("Erreur lors de la g√©n√©ration du QR d'info:",r)}}async function ve(){ee(),e(m).length===0&&await ue(),n(y,!0),n(_,0),K.clear(),de(),await j()}async function de(){if(!e(y))return;let t=[];if(e(D)==="recovery"&&e(Q).length>0?t=e(Q).map(s=>e(m)[s]).filter(Boolean):t=e(m),t.length===0){n(y,!1);return}if(e(_)>=t.length){n(y,!1),fe();return}n(x,[],!0);const r=[];for(let s=0;s<e(L)&&e(_)+s<t.length;s++){const v=t[e(_)+s];try{const o=[{data:v.binaryData,mode:"byte"}],d=ze.toDataURL(o,{errorCorrectionLevel:e(I),margin:1,width:1e3,color:{dark:"#000000",light:"#FFFFFF"}});r.push(d),K.add(v.chunkIndex)}catch(o){console.error("Error generating QR code:",o)}}try{n(x,await Promise.all(r),!0),n(_,e(_)+e(L)),setTimeout(de,e(Y))}catch(s){console.error("Error generating QR codes:",s),alert(`Error generating QR codes: ${s.message}

Try reducing the chunk size or changing the error correction level.`),n(y,!1)}}function ae(){n(y,!1)}async function fe(){if(n(F,!0),await j(),await j(),await new Promise(t=>setTimeout(t,50)),!e(S)){alert("Video element not ready. Please try again."),n(F,!1);return}e(k)&&!O&&(e(k).width=400,e(k).height=300,O=e(k).getContext("2d",{willReadFrequently:!0}));try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});e(S).srcObject=t,e(S).play(),requestAnimationFrame(_e)}catch(t){console.error("Erreur d'acc√®s √† la cam√©ra:",t),alert("Impossible d'acc√©der √† la cam√©ra"),n(F,!1)}}async function _e(){if(e(F)){if(e(S).readyState===e(S).HAVE_ENOUGH_DATA){O.drawImage(e(S),0,0,e(k).width,e(k).height);const t=O.getImageData(0,0,e(k).width,e(k).height);try{const r=await Tt(t);if(r&&r.length>0)for(const s of r){const v=s.decode();if(v)try{const o=JSON.parse(v);if(o.type==="recovery"&&o.fileHash===te(e(u))){n(Q,o.missingChunks,!0),re(),n(D,"recovery"),alert(`QR de r√©cup√©ration scann√© ! ${e(Q).length} chunks manquants d√©tect√©s.`);return}}catch{}}}catch(r){console.error("Erreur de scan zbar:",r)}}requestAnimationFrame(_e)}}function re(){n(F,!1),e(S)&&e(S).srcObject&&(e(S).srcObject.getTracks().forEach(t=>t.stop()),e(S).srcObject=null)}function Be(){ae(),re(),n(i,null),n(m,[],!0),n(u,null),n(_,0),n(z,""),n(x,[],!0),n($,""),n(Q,[],!0),n(D,"all"),K.clear()}async function Ue(t){n(i,t.target.files[0],!0),e(i)&&(await ue(),await j(),X?.focus())}Te(()=>{ee()}),Te(()=>{e(k)&&(O=e(k).getContext("2d"))});var me=Gt(),he=c(me),pe=l(c(he),2),je=l(c(pe),2);je.__change=Ue;var ye=l(pe,2);{var Ne=t=>{var r=Ft(),s=c(r),v=l(c(s)),o=c(v),d=l(v),C=l(s,2),H=l(c(C)),E=c(H);T((B,pt)=>{w(o,e(i).name),w(d,` (${B??""} kB ‚Üí ${e(A)??""} chunks)`),w(E,`sha1:${pt??""}`)},[()=>Math.round(e(i).size/1e3),()=>e(u)?te(e(u)):""]),p(t,r)};R(ye,t=>{e(i)&&t(Ne)})}var Pe=l(ye,2),Ve=l(c(Pe),2),be=c(Ve),Ge=l(c(be),2),ge=l(be,2),Je=l(c(ge),2),ke=l(ge,2),Se=l(c(ke),2),P=c(Se),We=c(P);P.value=P.__value="L";var V=l(P),Ye=c(V);V.value=V.__value="M";var G=l(V),Ke=c(G);G.value=G.__value="Q";var se=l(G),Xe=c(se);se.value=se.__value="H";var Ze=l(ke,2),J=l(c(Ze),2),et=l(J,2),tt=c(et),xe=l(he,2),Ce=c(xe);{var at=t=>{var r=Dt();r.__click=ae,Fe(r,21,()=>e(x),He,(s,v,o)=>{var d=Ht();U(d,"alt",`QR Code ${o+1}`),T(()=>U(d,"src",e(v))),p(s,d)}),p(t,r)},rt=t=>{var r=qe(),s=ne(r);{var v=o=>{var d=Lt();d.__click=ve,Fe(d,21,()=>Array(e(L)),He,(C,H,E)=>{var B=It();U(B,"alt",`QR Code d'information ${E+1}`),T(()=>U(B,"src",e($))),p(C,B)}),le(d,C=>X=C,()=>X),p(o,d)};R(s,o=>{e($)&&o(v)},!0)}p(t,r)};R(Ce,t=>{e(x).length>0?t(at):t(rt,!1)})}var st=l(Ce,2),we=c(st),nt=c(we);{var lt=t=>{var r=$t(),s=ne(r),v=l(s);{var o=d=>{var C=Ot();p(d,C)};R(v,d=>{e(D)==="recovery"&&d(o)})}T(d=>w(s,`Transmission in progress... Chunks ${e(_)-e(L)+1} - ${d??""}
          /
          ${(e(D)==="recovery"?e(Q).length:e(A))??""} `),[()=>Math.min(e(_),e(D)==="recovery"?e(Q).length:e(A))]),p(t,r)},ot=t=>{var r=qe(),s=ne(r);{var v=o=>{var d=At(`üì± QR code d'information - Scannez-le d'abord pour pr√©parer la
          r√©ception`);p(o,d)};R(s,o=>{e($)&&o(v)},!0)}p(t,r)};R(nt,t=>{e(y)?t(lt):t(ot,!1)})}var Re=l(we,2);{var it=t=>{var r=Bt();r.__click=ae,p(t,r)},ct=t=>{var r=Ut();r.__click=ve,T(()=>r.disabled=!e(i)),p(t,r)};R(Re,t=>{e(y)?t(it):t(ct,!1)})}var ut=l(Re,2);ut.__click=Be;var vt=l(xe,2),Qe=l(c(vt),4);{var dt=t=>{var r=jt();r.__click=fe,T(()=>r.disabled=!e(i)),p(t,r)},ft=t=>{var r=Nt();r.__click=re,p(t,r)};R(Qe,t=>{e(F)?t(ft,!1):t(dt)})}var Me=l(Qe,2);{var _t=t=>{var r=Pt(),s=c(r);le(s,o=>n(S,o),()=>e(S));var v=l(s,2);le(v,o=>n(k,o),()=>e(k)),p(t,r)};R(Me,t=>{e(F)&&t(_t)})}var mt=l(Me,2);{var ht=t=>{var r=Vt(),s=c(r);T(()=>w(s,`‚ö† ${e(Q).length??""} chunks to retransmit`)),p(t,r)};R(mt,t=>{e(Q).length>0&&t(ht)})}T((t,r)=>{w(We,`L (7% - Max ${g.L-250} bytes)`),w(Ye,`M (15% - Max ${g.M-250} bytes)`),w(Ke,`Q (25% - Max ${g.Q-250} bytes)`),w(Xe,`H (30% - Max ${g.H-250} bytes)`),U(J,"max",t),w(tt,`Max: ${r??""} bytes for ${e(I)??""} level`)},[Z,Z]),oe(Ge,()=>e(L),t=>n(L,t)),oe(Je,()=>e(Y),t=>n(Y,t)),zt(Se,()=>e(I),t=>n(I,t)),Qt("blur",J,ee),oe(J,()=>e(M),t=>n(M,t)),p(a,me),Mt()}wt(["change","click"]);Et(Jt,{target:document.body});
