import{l as Ie,c as z,b as bt,t as gt,i as kt,s as St,d as xt,p as Le,D as Ee,g as Te,h as j,u as Ct,r as wt,j as Rt,k as Qt,n as p,o as W,q as qe,f as b,v as l,w as c,x as q,y as e,z as Mt,a as y,A as At,B as n,C as w,E as ze,F as oe,G as Et,m as Tt}from"./disclose-version-UNGnYCer.js";import{i as R,Q as Fe,s as U,e as He,a as De,b as Y,S as qt}from"./index-B2xt4Leg.js";function Be(a,f,g=!1){if(a.multiple){if(f==null)return;if(!kt(f))return St();for(var i of a.options)i.selected=f.includes(N(i));return}for(i of a.options){var m=N(i);if(xt(m,f)){i.selected=!0;return}}(!g||f!==void 0)&&(a.selectedIndex=-1)}function zt(a){var f=new MutationObserver(()=>{Be(a,a.__value)});f.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),gt(()=>{f.disconnect()})}function Ft(a,f,g=f){var i=new WeakSet,m=!0;Ie(a,"change",u=>{var h=u?"[selected]":":checked",_;if(a.multiple)_=[].map.call(a.querySelectorAll(h),N);else{var F=a.querySelector(h)??a.querySelector("option:not([disabled])");_=F&&N(F)}g(_),z!==null&&i.add(z)}),bt(()=>{var u=f();if(a===document.activeElement){var h=Le??z;if(i.has(h))return}if(Be(a,u,m),m&&u===void 0){var _=a.querySelector(":checked");_!==null&&(u=N(_),g(u))}a.__value=u,m=!1}),zt(a)}function N(a){return"__value"in a?a.__value:a.value}function ie(a,f,g=f){var i=new WeakSet;Ie(a,"input",async m=>{Ee&&a.type==="checkbox"&&Te();var u=m?a.defaultValue:a.value;if(u=ce(a)?ue(u):u,g(u),z!==null&&i.add(z),await j(),u!==(u=f())){var h=a.selectionStart,_=a.selectionEnd,F=a.value.length;if(a.value=u??"",_!==null){var x=a.value.length;h===_&&_===F&&x>F?(a.selectionStart=x,a.selectionEnd=x):(a.selectionStart=h,a.selectionEnd=Math.min(_,x))}}}),Ct(f)==null&&a.value&&(g(ce(a)?ue(a.value):a.value),z!==null&&i.add(z)),wt(()=>{Ee&&a.type==="checkbox"&&Te();var m=f();if(a===document.activeElement){var u=Le??z;if(i.has(u))return}ce(a)&&m===ue(a.value)||a.type==="date"&&!m&&!a.value||m!==a.value&&(a.value=m??"")})}function ce(a){var f=a.type;return f==="number"||f==="range"}function ue(a){return a===""?null:+a}var Ht=b('<div class="file-info"><p>‚úì File: <strong> </strong> </p> <p>Hash: <code> </code></p></div>'),Dt=b('<img class="svelte-1ecl6tu"/>'),It=b('<button type="button" class="qr-display svelte-1ecl6tu"></button>'),Lt=b('<img class="svelte-1ecl6tu"/>'),Bt=b('<button type="button" class="qr-display svelte-1ecl6tu"></button>'),Ot=b('<span class="recovery-mode svelte-1ecl6tu">(Recovery mode)</span>'),$t=b(" <!>",1),Ut=b('<button class="danger svelte-1ecl6tu">‚èπ Stop</button>'),jt=b('<button type="button" class="primary svelte-1ecl6tu">‚ñ∂ Start Transmission</button>'),Nt=b('<button class="svelte-1ecl6tu">üì∑ Scan Recovery QR</button>'),Pt=b('<button class="danger svelte-1ecl6tu">‚èπ Stop le scan</button>'),Vt=b('<div class="scanner-view svelte-1ecl6tu"><video width="400" height="300" style="display:block;" class="svelte-1ecl6tu"></video> <canvas width="400" height="300" style="display:none;"></canvas></div>',2),Gt=b('<p class="info svelte-1ecl6tu"> </p>'),Jt=b('<main class="svelte-1ecl6tu"><header class="card svelte-1ecl6tu"><h1>üì§ QR Code Sender</h1> <p class="field"><label for="fileInput" class="svelte-1ecl6tu">Select a file</label> <input id="fileInput" type="file" accept="*/*" class="svelte-1ecl6tu"/></p> <!> <details><summary>Transmission Parameters (advanced options)</summary> <div class="settings svelte-1ecl6tu"><p class="field"><label for="numberOfQRCodes" class="svelte-1ecl6tu">Nombre de QR codes simultan√©s:</label> <input id="numberOfQRCodes" type="number" min="1" max="9" step="1" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu">Afficher plusieurs QR codes √† la fois pour acc√©l√©rer le transfert</span></p> <p class="field"><label for="transmissionSpeed" class="svelte-1ecl6tu">Transmission speed (ms):</label> <input id="transmissionSpeed" type="number" min="100" max="5000" step="50" class="svelte-1ecl6tu"/></p> <p class="field"><label for="errorCorrectionLevel" class="svelte-1ecl6tu">Error correction level:</label> <select id="errorCorrectionLevel" class="svelte-1ecl6tu"><option> </option><option> </option><option> </option><option> </option></select></p> <p class="field"><label for="chunkSize" class="svelte-1ecl6tu">Chunk size (bytes):</label> <input id="chunkSize" type="number" min="500" step="100" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu"> </span></p></div></details></header> <section class="main-content svelte-1ecl6tu"><!> <div class="controls svelte-1ecl6tu"><p class="status svelte-1ecl6tu"><!></p> <!> <button type="button" class="secondary svelte-1ecl6tu">üîÑ Reset</button></div></section> <footer class="card svelte-1ecl6tu"><h2>Missing chunks recovery</h2> <p>Scan the recovery QR code displayed by the receiver</p> <!> <!> <!></footer></main>');function Wt(a,f){Qt(f,!0);const g={L:2953,M:2331,Q:1663,H:1273};let i=p(null),m=p(W([])),u=p(null),h=p(!1),_=p(0),F=p(""),x=p(W([])),k=p(void 0),S=p(void 0),B,H=p(!1),Q=p(W([])),D=p("all"),M=p(1400),K=p(100),I=p("M"),L=p(1),A=p(0),X=W(new Set),O=p(""),Z,ee;function te(){return g[e(I)]-23}function ae(){const t=te();e(M)>t&&(n(M,t,!0),alert(`Chunk size adjusted to ${t} bytes to fit in QR code with ${e(I)} error correction.`))}async function Oe(t){const r=await t.arrayBuffer(),s=await crypto.subtle.digest("SHA-1",r);return new Uint8Array(s)}function re(t){return Array.from(t).map(r=>r.toString(16).padStart(2,"0")).join("")}async function ve(){if(!e(i))return;n(u,await Oe(e(i)),!0);const t=await e(i).arrayBuffer(),r=new Uint8Array(t);n(m,[],!0),n(A,Math.ceil(r.length/e(M)),!0);let s=1;e(A)>255&&(s=2),e(A)>65535&&(s=3);for(let v=0;v<e(A);v++){const o=v*e(M),d=Math.min(o+e(M),r.length),C=r.slice(o,d),E=new Uint8Array(20+s+C.length);E.set(e(u),0);for(let T=0;T<s;T++)E[20+T]=v>>8*(s-1-T)&255;E.set(C,20+s),e(m).push({binaryData:E,chunkIndex:v,fileName:e(i).name})}await $e()}async function $e(){const t={type:"fileInfo",fileHash:re(e(u)),fileName:e(i).name,fileSize:e(i).size,totalChunks:e(A),chunkSize:e(M)};try{n(O,await Fe.toDataURL(JSON.stringify(t),{errorCorrectionLevel:"M",margin:1,width:800}),!0)}catch(r){console.error("Erreur lors de la g√©n√©ration du QR d'info:",r)}}async function de(){console.log("Starting transmission..."),ae(),e(m).length===0&&await ve(),n(h,!0),n(_,0),X.clear(),fe(),await j(),ee?.focus()}async function fe(){if(!e(h))return;let t=[];if(e(D)==="recovery"&&e(Q).length>0?t=e(Q).map(s=>e(m)[s]).filter(Boolean):t=e(m),t.length===0){n(h,!1);return}if(e(_)>=t.length){n(h,!1),_e();return}n(x,[],!0);const r=[];for(let s=0;s<e(L)&&e(_)+s<t.length;s++){const v=t[e(_)+s];try{const o=[{data:v.binaryData,mode:"byte"}],d=Fe.toDataURL(o,{errorCorrectionLevel:e(I),margin:1,width:1e3,color:{dark:"#000000",light:"#FFFFFF"}});r.push(d),X.add(v.chunkIndex)}catch(o){console.error("Error generating QR code:",o)}}try{n(x,await Promise.all(r),!0),n(_,e(_)+e(L)),setTimeout(fe,e(K))}catch(s){console.error("Error generating QR codes:",s),alert(`Error generating QR codes: ${s.message}

Try reducing the chunk size or changing the error correction level.`),n(h,!1)}}function se(){console.log("Stopping transmission..."),n(h,!1)}async function _e(){if(n(H,!0),await j(),await j(),await new Promise(t=>setTimeout(t,50)),!e(S)){alert("Video element not ready. Please try again."),n(H,!1);return}e(k)&&!B&&(e(k).width=400,e(k).height=300,B=e(k).getContext("2d",{willReadFrequently:!0}));try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});e(S).srcObject=t,e(S).play(),requestAnimationFrame(me)}catch(t){console.error("Erreur d'acc√®s √† la cam√©ra:",t),alert("Impossible d'acc√©der √† la cam√©ra"),n(H,!1)}}async function me(){if(e(H)){if(e(S).readyState===e(S).HAVE_ENOUGH_DATA){B.drawImage(e(S),0,0,e(k).width,e(k).height);const t=B.getImageData(0,0,e(k).width,e(k).height);try{const r=await qt(t);if(r&&r.length>0)for(const s of r){const v=s.decode();if(v)try{const o=JSON.parse(v);if(o.type==="recovery"&&o.fileHash===re(e(u))){n(Q,o.missingChunks,!0),ne(),n(D,"recovery"),alert(`QR de r√©cup√©ration scann√© ! ${e(Q).length} chunks manquants d√©tect√©s.`);return}}catch{}}}catch(r){console.error("Erreur de scan zbar:",r)}}requestAnimationFrame(me)}}function ne(){n(H,!1),e(S)&&e(S).srcObject&&(e(S).srcObject.getTracks().forEach(t=>t.stop()),e(S).srcObject=null)}function Ue(){se(),ne(),n(i,null),n(m,[],!0),n(u,null),n(_,0),n(F,""),n(x,[],!0),n(O,""),n(Q,[],!0),n(D,"all"),X.clear()}async function je(t){n(i,t.target.files[0],!0),e(i)&&(await ve(),await j(),Z?.focus())}qe(()=>{ae()}),qe(()=>{e(k)&&(B=e(k).getContext("2d"))});var he=Jt(),pe=c(he),ye=l(c(pe),2),Ne=l(c(ye),2);Ne.__change=je;var be=l(ye,2);{var Pe=t=>{var r=Ht(),s=c(r),v=l(c(s)),o=c(v),d=l(v),C=l(s,2),E=l(c(C)),T=c(E);q(($,yt)=>{w(o,e(i).name),w(d,` (${$??""} kB ‚Üí ${e(A)??""} chunks)`),w(T,`sha1:${yt??""}`)},[()=>Math.round(e(i).size/1e3),()=>e(u)?re(e(u)):""]),y(t,r)};R(be,t=>{e(i)&&t(Pe)})}var Ve=l(be,2),Ge=l(c(Ve),2),ge=c(Ge),Je=l(c(ge),2),ke=l(ge,2),We=l(c(ke),2),Se=l(ke,2),xe=l(c(Se),2),P=c(xe),Ye=c(P);P.value=P.__value="L";var V=l(P),Ke=c(V);V.value=V.__value="M";var G=l(V),Xe=c(G);G.value=G.__value="Q";var le=l(G),Ze=c(le);le.value=le.__value="H";var et=l(Se,2),J=l(c(et),2),tt=l(J,2),at=c(tt),Ce=l(pe,2),we=c(Ce);{var rt=t=>{var r=It();r.__click=de,He(r,21,()=>Array(e(L)),De,(s,v,o)=>{var d=Dt();U(d,"alt",`QR Code d'information ${o+1}`),q(()=>U(d,"src",e(O))),y(s,d)}),Y(r,s=>Z=s,()=>Z),y(t,r)},st=t=>{var r=ze(),s=oe(r);{var v=o=>{var d=Bt();d.__click=se,He(d,21,()=>e(x),De,(C,E,T)=>{var $=Lt();U($,"alt",`QR Code ${T+1}`),q(()=>U($,"src",e(E))),y(C,$)}),Y(d,C=>ee=C,()=>ee),y(o,d)};R(s,o=>{e(h)&&e(x).length>0&&o(v)},!0)}y(t,r)};R(we,t=>{!e(h)&&e(O)?t(rt):t(st,!1)})}var nt=l(we,2),Re=c(nt),lt=c(Re);{var ot=t=>{var r=$t(),s=oe(r),v=l(s);{var o=d=>{var C=Ot();y(d,C)};R(v,d=>{e(D)==="recovery"&&d(o)})}q(d=>w(s,`Transmission in progress... Chunks ${e(_)-e(L)+1} - ${d??""}
          /
          ${(e(D)==="recovery"?e(Q).length:e(A))??""} `),[()=>Math.min(e(_),e(D)==="recovery"?e(Q).length:e(A))]),y(t,r)},it=t=>{var r=ze(),s=oe(r);{var v=o=>{var d=Et(`üì± QR code d'information - Scannez-le d'abord pour pr√©parer la
          r√©ception`);y(o,d)};R(s,o=>{e(O)&&o(v)},!0)}y(t,r)};R(lt,t=>{e(h)?t(ot):t(it,!1)})}var Qe=l(Re,2);{var ct=t=>{var r=Ut();r.__click=se,y(t,r)},ut=t=>{var r=jt();r.__click=de,q(()=>r.disabled=!e(i)),y(t,r)};R(Qe,t=>{e(h)?t(ct):t(ut,!1)})}var vt=l(Qe,2);vt.__click=Ue;var dt=l(Ce,2),Me=l(c(dt),4);{var ft=t=>{var r=Nt();r.__click=_e,q(()=>r.disabled=!e(i)),y(t,r)},_t=t=>{var r=Pt();r.__click=ne,y(t,r)};R(Me,t=>{e(H)?t(_t,!1):t(ft)})}var Ae=l(Me,2);{var mt=t=>{var r=Vt(),s=c(r);Y(s,o=>n(S,o),()=>e(S));var v=l(s,2);Y(v,o=>n(k,o),()=>e(k)),y(t,r)};R(Ae,t=>{e(H)&&t(mt)})}var ht=l(Ae,2);{var pt=t=>{var r=Gt(),s=c(r);q(()=>w(s,`‚ö† ${e(Q).length??""} chunks to retransmit`)),y(t,r)};R(ht,t=>{e(Q).length>0&&t(pt)})}q((t,r)=>{w(Ye,`L (7% - Max ${g.L-250} bytes)`),w(Ke,`M (15% - Max ${g.M-250} bytes)`),w(Xe,`Q (25% - Max ${g.Q-250} bytes)`),w(Ze,`H (30% - Max ${g.H-250} bytes)`),U(J,"max",t),w(at,`Max: ${r??""} bytes for ${e(I)??""} level`)},[te,te]),ie(Je,()=>e(L),t=>n(L,t)),ie(We,()=>e(K),t=>n(K,t)),Ft(xe,()=>e(I),t=>n(I,t)),Mt("blur",J,ae),ie(J,()=>e(M),t=>n(M,t)),y(a,he),At()}Rt(["change","click"]);Tt(Wt,{target:document.body});
