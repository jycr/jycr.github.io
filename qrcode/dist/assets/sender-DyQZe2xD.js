import{l as ke,c as R,b as Ke,t as Xe,i as Ze,s as et,d as tt,p as Se,g as Z,u as at,r as rt,h as st,j as lt,k as _,n as Y,o as pe,f as k,q as n,v as c,w as T,x as e,y as nt,a as g,z as it,A as s,B as x,C as ct,D as ot,m as vt}from"./disclose-version-D1SOqajz.js";import{i as M,s as ye,b as be,Q as ut,j as dt}from"./jsQR-Di8IMrsB.js";function xe(a,v,m=!1){if(a.multiple){if(v==null)return;if(!Ze(v))return et();for(var i of a.options)i.selected=v.includes(I(i));return}for(i of a.options){var u=I(i);if(tt(u,v)){i.selected=!0;return}}(!m||v!==void 0)&&(a.selectedIndex=-1)}function ft(a){var v=new MutationObserver(()=>{xe(a,a.__value)});v.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Xe(()=>{v.disconnect()})}function ht(a,v,m=v){var i=new WeakSet,u=!0;ke(a,"change",o=>{var h=o?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(h),I);else{var S=a.querySelector(h)??a.querySelector("option:not([disabled])");d=S&&I(S)}m(d),R!==null&&i.add(R)}),Ke(()=>{var o=v();if(a===document.activeElement){var h=Se??R;if(i.has(h))return}if(xe(a,o,u),u&&o===void 0){var d=a.querySelector(":checked");d!==null&&(o=I(d),m(o))}a.__value=o,u=!1}),ft(a)}function I(a){return"__value"in a?a.__value:a.value}function ge(a,v,m=v){var i=new WeakSet;ke(a,"input",async u=>{var o=u?a.defaultValue:a.value;if(o=K(a)?X(o):o,m(o),R!==null&&i.add(R),await Z(),o!==(o=v())){var h=a.selectionStart,d=a.selectionEnd,S=a.value.length;if(a.value=o??"",d!==null){var f=a.value.length;h===d&&d===S&&f>S?(a.selectionStart=f,a.selectionEnd=f):(a.selectionStart=h,a.selectionEnd=Math.min(d,f))}}}),at(v)==null&&a.value&&(m(K(a)?X(a.value):a.value),R!==null&&i.add(R)),rt(()=>{var u=v();if(a===document.activeElement){var o=Se??R;if(i.has(o))return}K(a)&&u===X(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}function K(a){var v=a.type;return v==="number"||v==="range"}function X(a){return a===""?null:+a}var _t=k('<div class="file-info"><p class="svelte-1ecl6tu">âœ“ File: <strong> </strong> </p> <p class="svelte-1ecl6tu">Hash: <code class="svelte-1ecl6tu"> </code></p></div>'),mt=k('<button class="primary svelte-1ecl6tu">â–¶ Start Transmission</button>'),pt=k('<button class="danger svelte-1ecl6tu">â¹ Stop</button>'),yt=k('<span class="recovery-mode svelte-1ecl6tu">(Recovery mode)</span>'),bt=k('<div class="qr-display svelte-1ecl6tu"><img alt="QR Code" class="svelte-1ecl6tu"/></div>'),gt=k('<p class="status svelte-1ecl6tu"> <!></p> <!>',1),kt=k('<button class="svelte-1ecl6tu">ğŸ“· Scan Recovery QR</button>'),St=k('<button class="danger svelte-1ecl6tu">â¹ Stop le scan</button>'),xt=k('<div class="scanner-view svelte-1ecl6tu"><video width="400" height="300" style="display:block;" class="svelte-1ecl6tu"></video> <canvas width="400" height="300" style="display:none;"></canvas></div>',2),Ct=k('<p class="info svelte-1ecl6tu"> </p>'),wt=k('<main class="svelte-1ecl6tu"><h1 class="svelte-1ecl6tu">ğŸ“¤ QR Code Sender</h1> <div class="card svelte-1ecl6tu"><p class="field svelte-1ecl6tu"><label for="fileInput" class="svelte-1ecl6tu">Select a file</label> <input id="fileInput" type="file" accept="*/*" class="svelte-1ecl6tu"/></p> <!> <details><summary>Transmission Parameters (advanced options)</summary> <div class="settings svelte-1ecl6tu"><p class="field svelte-1ecl6tu"><label for="transmissionSpeed" class="svelte-1ecl6tu">Transmission speed (ms):</label> <input id="transmissionSpeed" type="number" min="100" max="5000" step="50" class="svelte-1ecl6tu"/></p> <p class="field svelte-1ecl6tu"><label for="errorCorrectionLevel" class="svelte-1ecl6tu">Error correction level:</label> <select id="errorCorrectionLevel" class="svelte-1ecl6tu"><option> </option><option> </option><option> </option><option> </option></select></p> <p class="field svelte-1ecl6tu"><label for="chunkSize" class="svelte-1ecl6tu">Chunk size (bytes):</label> <input id="chunkSize" type="number" min="500" step="100" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu"> </span></p></div></details> <div class="controls svelte-1ecl6tu"><!> <button class="secondary svelte-1ecl6tu">ğŸ”„ Reset</button></div> <!></div> <div class="card svelte-1ecl6tu"><h2 class="svelte-1ecl6tu">Missing chunks recovery</h2> <p class="svelte-1ecl6tu">Scan the recovery QR code displayed by the receiver</p> <!> <!> <!></div></main>');function Mt(a,v){lt(v,!0);const m={L:2953,M:2331,Q:1663,H:1273};let i=_(null),u=_(Y([])),o=_(""),h=_(!1),d=_(0),S=_(""),f=_(void 0),p=_(void 0),$,A=_(!1),C=_(Y([])),E=_("all"),Q=_(1400),U=_(100),F=_("M"),q=_(0),N=Y(new Set);function P(){return m[e(F)]-250}function V(){const t=P();e(Q)>t&&(s(Q,t,!0),alert(`Chunk size adjusted to ${t} bytes to fit in QR code with ${e(F)} error correction.`))}async function Ce(t){const r=await t.arrayBuffer(),l=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(l)).map(b=>b.toString(16).padStart(2,"0")).join("")}async function ee(){if(!e(i))return;s(o,await Ce(e(i)),!0);const t=await e(i).arrayBuffer(),r=new Uint8Array(t);s(u,[],!0),s(q,Math.ceil(r.length/e(Q)),!0);for(let l=0;l<e(q);l++){const y=l*e(Q),b=Math.min(y+e(Q),r.length),j=r.slice(y,b),z=btoa(String.fromCharCode(...j));e(u).push({fileHash:e(o),fileName:e(i).name,chunkIndex:l,totalChunks:e(q),data:z})}}async function we(){V(),e(u).length===0&&await ee(),s(h,!0),s(d,0),N.clear(),te()}async function te(){if(!e(h))return;let t=[];if(e(E)==="recovery"&&e(C).length>0?t=e(C).map(l=>e(u)[l]).filter(Boolean):t=e(u),t.length===0){s(h,!1);return}if(e(d)>=t.length){s(h,!1),re();return}const r=t[e(d)];try{const l=JSON.stringify(r);s(S,await ut.toDataURL(l,{errorCorrectionLevel:e(F),margin:1,width:600,color:{dark:"#000000",light:"#FFFFFF"}}),!0),N.add(r.chunkIndex),ot(d),setTimeout(te,e(U))}catch(l){console.error("Error generating QR code:",l),alert(`Error generating QR code: ${l.message}

Try reducing the chunk size or changing the error correction level.`),s(h,!1)}}function ae(){s(h,!1)}async function re(){if(s(A,!0),await Z(),await Z(),await new Promise(t=>setTimeout(t,50)),!e(p)){alert("Video element not ready. Please try again."),s(A,!1);return}e(f)&&!$&&(e(f).width=400,e(f).height=300,$=e(f).getContext("2d",{willReadFrequently:!0}));try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});e(p).srcObject=t,e(p).play(),requestAnimationFrame(se)}catch(t){console.error("Erreur d'accÃ¨s Ã  la camÃ©ra:",t),alert("Impossible d'accÃ©der Ã  la camÃ©ra"),s(A,!1)}}function se(){if(e(A)){if(e(p).readyState===e(p).HAVE_ENOUGH_DATA){$.drawImage(e(p),0,0,e(f).width,e(f).height);const t=$.getImageData(0,0,e(f).width,e(f).height),r=dt(t.data,t.width,t.height);if(r)try{const l=JSON.parse(r.data);if(l.type==="recovery"&&l.fileHash===e(o)){s(C,l.missingChunks,!0),J(),s(E,"recovery"),alert(`QR de rÃ©cupÃ©ration scannÃ© ! ${e(C).length} chunks manquants dÃ©tectÃ©s.`);return}}catch{}}requestAnimationFrame(se)}}function J(){s(A,!1),e(p)&&e(p).srcObject&&(e(p).srcObject.getTracks().forEach(t=>t.stop()),e(p).srcObject=null)}function Me(){ae(),J(),s(i,null),s(u,[],!0),s(o,""),s(d,0),s(S,""),s(C,[],!0),s(E,"all"),N.clear()}function Re(t){s(i,t.target.files[0],!0),e(i)&&ee()}pe(()=>{V()}),pe(()=>{e(f)&&($=e(f).getContext("2d"))});var le=wt(),ne=n(c(le),2),ie=c(ne),Ae=n(c(ie),2);Ae.__change=Re;var ce=n(ie,2);{var Qe=t=>{var r=_t(),l=c(r),y=n(c(l)),b=c(y),j=n(y),z=n(l,2),G=n(c(z)),w=c(G);T(H=>{x(b,e(i).name),x(j,` (${H??""} kB
					â†’ ${e(q)??""} chunks)`),x(w,`sha256:${e(o)??""}`)},[()=>Math.round(e(i).size/1e3)]),g(t,r)};M(ce,t=>{e(i)&&t(Qe)})}var oe=n(ce,2),Te=n(c(oe),2),ve=c(Te),Ee=n(c(ve),2),ue=n(ve,2),de=n(c(ue),2),L=c(de),Fe=c(L);L.value=L.__value="L";var O=n(L),qe=c(O);O.value=O.__value="M";var B=n(O),He=c(B);B.value=B.__value="Q";var W=n(B),$e=c(W);W.value=W.__value="H";var je=n(ue,2),D=n(c(je),2),ze=n(D,2),Ie=c(ze),fe=n(oe,2),he=c(fe);{var Le=t=>{var r=mt();r.__click=we,T(()=>r.disabled=!e(i)),g(t,r)},Oe=t=>{var r=pt();r.__click=ae,g(t,r)};M(he,t=>{e(h)?t(Oe,!1):t(Le)})}var Be=n(he,2);Be.__click=Me;var De=n(fe,2);{var Ue=t=>{var r=gt(),l=ct(r),y=c(l),b=n(y);{var j=w=>{var H=yt();g(w,H)};M(b,w=>{e(E)==="recovery"&&w(j)})}var z=n(l,2);{var G=w=>{var H=bt(),Ye=c(H);T(()=>ye(Ye,"src",e(S))),g(w,H)};M(z,w=>{e(S)&&w(G)})}T(()=>x(y,`Transmission in progress...
				Chunk ${e(d)%(e(E)==="recovery"?e(C).length:e(q))+1}
				/
				${(e(E)==="recovery"?e(C).length:e(q))??""} `)),g(t,r)};M(De,t=>{e(h)&&t(Ue)})}var Ne=n(ne,2),_e=n(c(Ne),4);{var Pe=t=>{var r=kt();r.__click=re,T(()=>r.disabled=!e(i)),g(t,r)},Ve=t=>{var r=St();r.__click=J,g(t,r)};M(_e,t=>{e(A)?t(Ve,!1):t(Pe)})}var me=n(_e,2);{var Je=t=>{var r=xt(),l=c(r);be(l,b=>s(p,b),()=>e(p));var y=n(l,2);be(y,b=>s(f,b),()=>e(f)),g(t,r)};M(me,t=>{e(A)&&t(Je)})}var We=n(me,2);{var Ge=t=>{var r=Ct(),l=c(r);T(()=>x(l,`âš  ${e(C).length??""} chunks to retransmit`)),g(t,r)};M(We,t=>{e(C).length>0&&t(Ge)})}T((t,r)=>{x(Fe,`L (7% - Max ${m.L-250} bytes)`),x(qe,`M (15% - Max ${m.M-250} bytes)`),x(He,`Q (25% - Max ${m.Q-250} bytes)`),x($e,`H (30% - Max ${m.H-250} bytes)`),ye(D,"max",t),x(Ie,`Max: ${r??""} bytes for ${e(F)??""} level`)},[P,P]),ge(Ee,()=>e(U),t=>s(U,t)),ht(de,()=>e(F),t=>s(F,t)),nt("blur",D,V),ge(D,()=>e(Q),t=>s(Q,t)),g(a,le),it()}st(["change","click"]);vt(Mt,{target:document.getElementById("app")});
