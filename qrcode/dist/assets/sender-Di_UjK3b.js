import{l as Le,c as M,b as gt,t as kt,i as St,s as Ct,d as xt,p as je,D as Ee,g as qe,h as B,u as Rt,r as Qt,j as wt,k as Tt,n as b,o as G,q as le,f as g,v as n,w as o,x as T,y as t,z as Mt,a as h,A as zt,B as s,C as S,E as $e,F as ie,G as Et,m as qt}from"./disclose-version-CVD8pSWN.js";import{i as x,s as $t,g as Ft,Q as j,a as O,v as At,b as Fe,e as Ae,c as He,d as J,f as Ie,h as Ht,j as It,k as Lt,l as jt,m as Ot}from"./scannerService-CEV5QOf7.js";function Oe(a,c,u=!1){if(a.multiple){if(c==null)return;if(!St(c))return Ct();for(var _ of a.options)_.selected=c.includes(P(_));return}for(_ of a.options){var v=P(_);if(xt(v,c)){_.selected=!0;return}}(!u||c!==void 0)&&(a.selectedIndex=-1)}function Bt(a){var c=new MutationObserver(()=>{Oe(a,a.__value)});c.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),kt(()=>{c.disconnect()})}function Pt(a,c,u=c){var _=new WeakSet,v=!0;Le(a,"change",i=>{var m=i?"[selected]":":checked",k;if(a.multiple)k=[].map.call(a.querySelectorAll(m),P);else{var C=a.querySelector(m)??a.querySelector("option:not([disabled])");k=C&&P(C)}u(k),M!==null&&_.add(M)}),gt(()=>{var i=c();if(a===document.activeElement){var m=je??M;if(_.has(m))return}if(Oe(a,i,v),v&&i===void 0){var k=a.querySelector(":checked");k!==null&&(i=P(k),u(i))}a.__value=i,v=!1}),Bt(a)}function P(a){return"__value"in a?a.__value:a.value}function oe(a,c,u=c){var _=new WeakSet;Le(a,"input",async v=>{Ee&&a.type==="checkbox"&&qe();var i=v?a.defaultValue:a.value;if(i=ce(a)?ue(i):i,u(i),M!==null&&_.add(M),await B(),i!==(i=c())){var m=a.selectionStart,k=a.selectionEnd,C=a.value.length;if(a.value=i??"",k!==null){var y=a.value.length;m===k&&k===C&&y>C?(a.selectionStart=y,a.selectionEnd=y):(a.selectionStart=m,a.selectionEnd=Math.min(k,y))}}}),Rt(c)==null&&a.value&&(u(ce(a)?ue(a.value):a.value),M!==null&&_.add(M)),Qt(()=>{Ee&&a.type==="checkbox"&&qe();var v=c();if(a===document.activeElement){var i=je??M;if(_.has(i))return}ce(a)&&v===ue(a.value)||a.type==="date"&&!v&&!a.value||v!==a.value&&(a.value=v??"")})}function ce(a){var c=a.type;return c==="number"||c==="range"}function ue(a){return a===""?null:+a}var Vt=g('<div class="file-info"><p>‚úì File: <strong> </strong> </p> <p>Hash: <code> </code></p></div>'),Dt=g('<img class="svelte-1ecl6tu"/>'),Nt=g('<button type="button" class="qr-display svelte-1ecl6tu"></button>'),Ut=g('<img class="svelte-1ecl6tu"/>'),Wt=g('<button type="button" class="qr-display svelte-1ecl6tu"></button>'),Gt=g('<span class="recovery-mode svelte-1ecl6tu">(Recovery mode)</span>'),Jt=g(" <!>",1),Yt=g('<button class="danger svelte-1ecl6tu">‚èπ Stop</button>'),Kt=g('<button type="button" class="primary svelte-1ecl6tu">‚ñ∂ Start Transmission</button>'),Xt=g('<button class="svelte-1ecl6tu">üì∑ Scan Recovery QR</button>'),Zt=g('<button class="danger svelte-1ecl6tu">‚èπ Stop le scan</button>'),ea=g('<div class="scanner-view svelte-1ecl6tu"><video width="400" height="300" style="display:block;" class="svelte-1ecl6tu"></video> <canvas width="400" height="300" style="display:none;"></canvas></div>',2),ta=g('<p class="info svelte-1ecl6tu"> </p>'),aa=g('<main class="svelte-1ecl6tu"><header class="card svelte-1ecl6tu"><h1>üì§ QR Code Sender</h1> <p class="field"><label for="fileInput" class="svelte-1ecl6tu">Select a file</label> <input id="fileInput" type="file" accept="*/*" class="svelte-1ecl6tu"/></p> <!> <details><summary>Transmission Parameters (advanced options)</summary> <div class="settings svelte-1ecl6tu"><p class="field"><label for="numberOfQRCodes" class="svelte-1ecl6tu">Nombre de QR codes simultan√©s:</label> <input id="numberOfQRCodes" type="number" min="1" max="9" step="1" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu">Afficher plusieurs QR codes √† la fois pour acc√©l√©rer le transfert</span></p> <p class="field"><label for="transmissionSpeed" class="svelte-1ecl6tu"> </label> <input id="transmissionSpeed" type="range" min="50" max="1500" step="50"/></p> <p class="field"><label for="errorCorrectionLevel" class="svelte-1ecl6tu">Error correction level:</label> <select id="errorCorrectionLevel" class="svelte-1ecl6tu"><option> </option><option> </option><option> </option><option> </option></select></p> <p class="field"><label for="chunkSize" class="svelte-1ecl6tu">Chunk size (bytes):</label> <input id="chunkSize" type="number" min="500" step="100" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu"> </span></p></div></details></header> <section class="main-content svelte-1ecl6tu"><!> <div class="controls svelte-1ecl6tu"><p class="status svelte-1ecl6tu"><!></p> <!> <button type="button" class="secondary svelte-1ecl6tu">üîÑ Reset</button></div></section> <footer class="card svelte-1ecl6tu"><h2>Missing chunks recovery</h2> <p>Scan the recovery QR code displayed by the receiver</p> <!> <!> <!></footer></main>');function ra(a,c){Tt(c,!0);let u=b(null),_=b(G([])),v=b(null),i=b(!1),m=b(0),k=b(""),C=b(G([])),y,R,A,z=b(!1),Q=b(G([])),$=b("all"),E=b(1400),V=b(100),w=b("M"),F=b(1),H=b(0),Y=G(new Set),I=b(""),K,X;function ve(){return j[t(w)]-23}function Z(){const e=At(t(E),t(w));e.wasAdjusted&&(s(E,e.adjustedSize,!0),alert(`Chunk size adjusted to ${e.adjustedSize} bytes to fit in QR code with ${t(w)} error correction.`))}async function ee(){if(!t(u))return;const e=await $t(t(u),t(E));s(v,e.fileHash,!0),s(_,e.chunks,!0),s(H,e.chunks.length,!0),await Be()}async function Be(){if(!(!t(u)||!t(v)))try{s(I,await Ft(t(u),t(v),t(H),t(E)),!0)}catch(e){console.error("Erreur lors de la g√©n√©ration du QR d'info:",e)}}async function de(){console.log("Starting transmission..."),Z(),t(_).length===0&&await ee(),s(i,!0),s(m,0),Y.clear(),fe(),await B(),X?.focus()}async function fe(){if(!t(i))return;const e=It(t(_),t(Q),t($));if(e.length===0){s(i,!1);return}if(t(m)>=e.length){s(i,!1),_e();return}const r=[];for(let l=0;l<t(F)&&t(m)+l<e.length;l++){const d=e[t(m)+l];r.push(d),Y.add(d.chunkIndex)}try{s(C,await Lt(r,t(w)),!0),s(m,t(m)+t(F)),setTimeout(fe,t(V))}catch(l){console.error("Error generating QR codes:",l),alert(`Error generating QR codes: ${l.message}

Try reducing the chunk size or changing the error correction level.`),s(i,!1)}}function te(){console.log("Stopping transmission..."),s(i,!1)}async function _e(){if(s(z,!0),await B(),await B(),await new Promise(e=>setTimeout(e,50)),!R){alert("Video element not ready. Please try again."),s(z,!1);return}y&&!A&&(y.width=400,y.height=300,A=Ie(y));try{await Ht(R,{facingMode:"environment"}),requestAnimationFrame(me)}catch(e){console.error("Erreur d'acc√®s √† la cam√©ra:",e),alert("Impossible d'acc√©der √† la cam√©ra"),s(z,!1)}}async function me(){if(!t(z)||!R||!y||!A)return;const e=await jt(R,y,A);if(e.length>0)for(const r of e){const l=r.decode();if(l)try{const d=JSON.parse(l);if(d.type==="recovery"&&t(v)&&d.fileHash===Fe(t(v))){s(Q,d.missingChunks,!0),ae(),s($,"recovery"),alert(`QR de r√©cup√©ration scann√© ! ${t(Q).length} chunks manquants d√©tect√©s.`);return}}catch{}}requestAnimationFrame(me)}function ae(){s(z,!1),R&&Ot(R)}function Pe(){te(),ae(),s(u,null),s(_,[],!0),s(v,null),s(m,0),s(k,""),s(C,[],!0),s(I,""),s(Q,[],!0),s($,"all"),Y.clear()}async function Ve(e){const r=e.target;s(u,r.files?.[0]||null,!0),t(u)&&(await ee(),await B(),K?.focus())}le(()=>{Z()}),le(()=>{t(E),t(w),t(u)&&ee()}),le(()=>{y&&(A=Ie(y))});var pe=aa(),he=o(pe),be=n(o(he),2),De=n(o(be),2);De.__change=Ve;var ye=n(be,2);{var Ne=e=>{var r=Vt(),l=o(r),d=n(o(l)),p=o(d),f=n(d),q=n(l,2),se=n(o(q)),ne=o(se);T((L,yt)=>{S(p,t(u).name),S(f,` (${L??""} kB ‚Üí ${t(H)??""} chunks)`),S(ne,`sha1:${yt??""}`)},[()=>Math.round(t(u).size/1e3),()=>t(v)?Fe(t(v)):""]),h(e,r)};x(ye,e=>{t(u)&&e(Ne)})}var Ue=n(ye,2),We=n(o(Ue),2),ge=o(We),Ge=n(o(ge),2),ke=n(ge,2),Se=o(ke),Je=o(Se),Ye=n(Se,2),Ce=n(ke,2),xe=n(o(Ce),2),D=o(xe),Ke=o(D);D.value=D.__value="L";var N=n(D),Xe=o(N);N.value=N.__value="M";var U=n(N),Ze=o(U);U.value=U.__value="Q";var re=n(U),et=o(re);re.value=re.__value="H";var tt=n(Ce,2),W=n(o(tt),2),at=n(W,2),rt=o(at),Re=n(he,2),Qe=o(Re);{var st=e=>{var r=Nt();r.__click=de,Ae(r,21,()=>Array(t(F)),He,(l,d,p)=>{var f=Dt();O(f,"alt",`QR Code d'information ${p+1}`),T(()=>O(f,"src",t(I))),h(l,f)}),J(r,l=>K=l,()=>K),h(e,r)},nt=e=>{var r=$e(),l=ie(r);{var d=p=>{var f=Wt();f.__click=te,Ae(f,21,()=>t(C),He,(q,se,ne)=>{var L=Ut();O(L,"alt",`QR Code ${ne+1}`),T(()=>O(L,"src",t(se))),h(q,L)}),J(f,q=>X=q,()=>X),h(p,f)};x(l,p=>{t(i)&&t(C).length>0&&p(d)},!0)}h(e,r)};x(Qe,e=>{!t(i)&&t(I)?e(st):e(nt,!1)})}var lt=n(Qe,2),we=o(lt),it=o(we);{var ot=e=>{var r=Jt(),l=ie(r),d=n(l);{var p=f=>{var q=Gt();h(f,q)};x(d,f=>{t($)==="recovery"&&f(p)})}T(f=>S(l,`Transmission in progress... Chunks ${t(m)-t(F)+1} - ${f??""}
          /
          ${(t($)==="recovery"?t(Q).length:t(H))??""} `),[()=>Math.min(t(m),t($)==="recovery"?t(Q).length:t(H))]),h(e,r)},ct=e=>{var r=$e(),l=ie(r);{var d=p=>{var f=Et(`üì± QR code d'information - Scannez-le d'abord pour pr√©parer la
          r√©ception`);h(p,f)};x(l,p=>{t(I)&&p(d)},!0)}h(e,r)};x(it,e=>{t(i)?e(ot):e(ct,!1)})}var Te=n(we,2);{var ut=e=>{var r=Yt();r.__click=te,h(e,r)},vt=e=>{var r=Kt();r.__click=de,T(()=>r.disabled=!t(u)),h(e,r)};x(Te,e=>{t(i)?e(ut):e(vt,!1)})}var dt=n(Te,2);dt.__click=Pe;var ft=n(Re,2),Me=n(o(ft),4);{var _t=e=>{var r=Xt();r.__click=_e,T(()=>r.disabled=!t(u)),h(e,r)},mt=e=>{var r=Zt();r.__click=ae,h(e,r)};x(Me,e=>{t(z)?e(mt,!1):e(_t)})}var ze=n(Me,2);{var pt=e=>{var r=ea(),l=o(r);J(l,p=>R=p,()=>R);var d=n(l,2);J(d,p=>y=p,()=>y),h(e,r)};x(ze,e=>{t(z)&&e(pt)})}var ht=n(ze,2);{var bt=e=>{var r=ta(),l=o(r);T(()=>S(l,`‚ö† ${t(Q).length??""} chunks to retransmit`)),h(e,r)};x(ht,e=>{t(Q).length>0&&e(bt)})}T((e,r)=>{S(Je,`Transmission speed (${t(V)??""} ms):`),S(Ke,`L (7% - Max ${j.L-250} bytes)`),S(Xe,`M (15% - Max ${j.M-250} bytes)`),S(Ze,`Q (25% - Max ${j.Q-250} bytes)`),S(et,`H (30% - Max ${j.H-250} bytes)`),O(W,"max",e),S(rt,`Max: ${r??""} bytes for ${t(w)??""} level`)},[ve,ve]),oe(Ge,()=>t(F),e=>s(F,e)),oe(Ye,()=>t(V),e=>s(V,e)),Pt(xe,()=>t(w),e=>s(w,e)),Mt("blur",W,Z),oe(W,()=>t(E),e=>s(E,e)),h(a,pe),zt()}wt(["change","click"]);qt(ra,{target:document.body});
