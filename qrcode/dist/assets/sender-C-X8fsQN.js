import{l as Ee,c as q,b as ht,t as _t,i as mt,s as pt,d as yt,p as ze,D as Re,g as Qe,h as L,u as bt,r as gt,j as kt,k as St,n as m,o as P,q as Me,f as g,v as o,w as i,x as A,y as e,z as Ct,a as y,A as xt,B as s,C as w,E as Ae,F as ae,G as wt,m as Rt}from"./disclose-version-CnRXLrRc.js";import{i as R,Q as qe,s as V,e as Qt,a as Mt,b as re,S as At}from"./index-C-j1oDEm.js";function Te(a,f,b=!1){if(a.multiple){if(f==null)return;if(!mt(f))return pt();for(var c of a.options)c.selected=f.includes($(c));return}for(c of a.options){var _=$(c);if(yt(_,f)){c.selected=!0;return}}(!b||f!==void 0)&&(a.selectedIndex=-1)}function qt(a){var f=new MutationObserver(()=>{Te(a,a.__value)});f.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),_t(()=>{f.disconnect()})}function Et(a,f,b=f){var c=new WeakSet,_=!0;Ee(a,"change",u=>{var p=u?"[selected]":":checked",h;if(a.multiple)h=[].map.call(a.querySelectorAll(p),$);else{var E=a.querySelector(p)??a.querySelector("option:not([disabled])");h=E&&$(E)}b(h),q!==null&&c.add(q)}),ht(()=>{var u=f();if(a===document.activeElement){var p=ze??q;if(c.has(p))return}if(Te(a,u,_),_&&u===void 0){var h=a.querySelector(":checked");h!==null&&(u=$(h),b(u))}a.__value=u,_=!1}),qt(a)}function $(a){return"__value"in a?a.__value:a.value}function se(a,f,b=f){var c=new WeakSet;Ee(a,"input",async _=>{Re&&a.type==="checkbox"&&Qe();var u=_?a.defaultValue:a.value;if(u=ne(a)?le(u):u,b(u),q!==null&&c.add(q),await L(),u!==(u=f())){var p=a.selectionStart,h=a.selectionEnd,E=a.value.length;if(a.value=u??"",h!==null){var C=a.value.length;p===h&&h===E&&C>E?(a.selectionStart=C,a.selectionEnd=C):(a.selectionStart=p,a.selectionEnd=Math.min(h,C))}}}),bt(f)==null&&a.value&&(b(ne(a)?le(a.value):a.value),q!==null&&c.add(q)),gt(()=>{Re&&a.type==="checkbox"&&Qe();var _=f();if(a===document.activeElement){var u=ze??q;if(c.has(u))return}ne(a)&&_===le(a.value)||a.type==="date"&&!_&&!a.value||_!==a.value&&(a.value=_??"")})}function ne(a){var f=a.type;return f==="number"||f==="range"}function le(a){return a===""?null:+a}var zt=g('<div class="file-info"><p>‚úì File: <strong> </strong> </p> <p>Hash: <code> </code></p></div>'),Tt=g('<button class="qr-display svelte-1ecl6tu" type="button"><img class="svelte-1ecl6tu"/></button>'),Ft=g('<div class="qr-grid svelte-1ecl6tu"></div>'),Ot=g(`<button class="qr-display svelte-1ecl6tu" type="button"><img alt="QR Code d'information" class="svelte-1ecl6tu"/></button>`),Ht=g('<span class="recovery-mode svelte-1ecl6tu">(Recovery mode)</span>'),Dt=g(" <!>",1),It=g('<button class="danger svelte-1ecl6tu">‚èπ Stop</button>'),Lt=g('<button type="button" class="primary svelte-1ecl6tu">‚ñ∂ Start Transmission</button>'),$t=g('<button class="svelte-1ecl6tu">üì∑ Scan Recovery QR</button>'),jt=g('<button class="danger svelte-1ecl6tu">‚èπ Stop le scan</button>'),Bt=g('<div class="scanner-view svelte-1ecl6tu"><video width="400" height="300" style="display:block;" class="svelte-1ecl6tu"></video> <canvas width="400" height="300" style="display:none;"></canvas></div>',2),Nt=g('<p class="info svelte-1ecl6tu"> </p>'),Ut=g('<main class="svelte-1ecl6tu"><header class="card svelte-1ecl6tu"><h1>üì§ QR Code Sender</h1> <p class="field"><label for="fileInput" class="svelte-1ecl6tu">Select a file</label> <input id="fileInput" type="file" accept="*/*" class="svelte-1ecl6tu"/></p> <!> <details><summary>Transmission Parameters (advanced options)</summary> <div class="settings svelte-1ecl6tu"><p class="field"><label for="numberOfQRCodes" class="svelte-1ecl6tu">Nombre de QR codes simultan√©s:</label> <input id="numberOfQRCodes" type="number" min="1" max="9" step="1" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu">Afficher plusieurs QR codes √† la fois pour acc√©l√©rer le transfert</span></p> <p class="field"><label for="transmissionSpeed" class="svelte-1ecl6tu">Transmission speed (ms):</label> <input id="transmissionSpeed" type="number" min="100" max="5000" step="50" class="svelte-1ecl6tu"/></p> <p class="field"><label for="errorCorrectionLevel" class="svelte-1ecl6tu">Error correction level:</label> <select id="errorCorrectionLevel" class="svelte-1ecl6tu"><option> </option><option> </option><option> </option><option> </option></select></p> <p class="field"><label for="chunkSize" class="svelte-1ecl6tu">Chunk size (bytes):</label> <input id="chunkSize" type="number" min="500" step="100" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu"> </span></p></div></details></header> <section class="main-content svelte-1ecl6tu"><!> <div class="controls svelte-1ecl6tu"><p class="status svelte-1ecl6tu"><!></p> <!> <button type="button" class="secondary svelte-1ecl6tu">üîÑ Reset</button></div></section> <footer class="card svelte-1ecl6tu"><h2>Missing chunks recovery</h2> <p>Scan the recovery QR code displayed by the receiver</p> <!> <!> <!></footer></main>');function Pt(a,f){St(f,!0);const b={L:2953,M:2331,Q:1663,H:1273};let c=m(null),_=m(P([])),u=m(""),p=m(!1),h=m(0),E=m(""),C=m(P([])),k=m(void 0),S=m(void 0),H,z=m(!1),Q=m(P([])),F=m("all"),M=m(1400),J=m(100),O=m("M"),D=m(4),T=m(0),G=P(new Set),I=m(""),W;function Y(){return b[e(O)]-250}function K(){const t=Y();e(M)>t&&(s(M,t,!0),alert(`Chunk size adjusted to ${t} bytes to fit in QR code with ${e(O)} error correction.`))}async function Fe(t){const r=await t.arrayBuffer(),n=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(n)).map(l=>l.toString(16).padStart(2,"0")).join("")}async function oe(){if(!e(c))return;s(u,await Fe(e(c)),!0);const t=await e(c).arrayBuffer(),r=new Uint8Array(t);s(_,[],!0),s(T,Math.ceil(r.length/e(M)),!0);for(let n=0;n<e(T);n++){const v=n*e(M),l=Math.min(v+e(M),r.length),d=r.slice(v,l),x=btoa(String.fromCharCode(...d));e(_).push({fileHash:e(u),fileName:e(c).name,chunkIndex:n,totalChunks:e(T),data:x})}await Oe()}async function Oe(){const t={type:"fileInfo",fileHash:e(u),fileName:e(c).name,fileSize:e(c).size,totalChunks:e(T),chunkSize:e(M)};try{s(I,await qe.toDataURL(JSON.stringify(t),{errorCorrectionLevel:"M",margin:1,width:800}),!0)}catch(r){console.error("Erreur lors de la g√©n√©ration du QR d'info:",r)}}async function ie(){K(),e(_).length===0&&await oe(),s(p,!0),s(h,0),G.clear(),ce(),await L()}async function ce(){if(!e(p))return;let t=[];if(e(F)==="recovery"&&e(Q).length>0?t=e(Q).map(n=>e(_)[n]).filter(Boolean):t=e(_),t.length===0){s(p,!1);return}if(e(h)>=t.length){s(p,!1),ue();return}s(C,[],!0);const r=[];for(let n=0;n<e(D)&&e(h)+n<t.length;n++){const v=t[e(h)+n];try{const l=JSON.stringify(v),d=qe.toDataURL(l,{errorCorrectionLevel:e(O),margin:1,width:1e3,color:{dark:"#000000",light:"#FFFFFF"}});r.push(d),G.add(v.chunkIndex)}catch(l){console.error("Error generating QR code:",l)}}try{s(C,await Promise.all(r),!0),s(h,e(h)+e(D)),setTimeout(ce,e(J))}catch(n){console.error("Error generating QR codes:",n),alert(`Error generating QR codes: ${n.message}

Try reducing the chunk size or changing the error correction level.`),s(p,!1)}}function X(){s(p,!1)}async function ue(){if(s(z,!0),await L(),await L(),await new Promise(t=>setTimeout(t,50)),!e(S)){alert("Video element not ready. Please try again."),s(z,!1);return}e(k)&&!H&&(e(k).width=400,e(k).height=300,H=e(k).getContext("2d",{willReadFrequently:!0}));try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});e(S).srcObject=t,e(S).play(),requestAnimationFrame(ve)}catch(t){console.error("Erreur d'acc√®s √† la cam√©ra:",t),alert("Impossible d'acc√©der √† la cam√©ra"),s(z,!1)}}async function ve(){if(e(z)){if(e(S).readyState===e(S).HAVE_ENOUGH_DATA){H.drawImage(e(S),0,0,e(k).width,e(k).height);const t=H.getImageData(0,0,e(k).width,e(k).height);try{const r=await At(t);if(r&&r.length>0)for(const n of r){const v=n.decode();if(v)try{const l=JSON.parse(v);if(l.type==="recovery"&&l.fileHash===e(u)){s(Q,l.missingChunks,!0),Z(),s(F,"recovery"),alert(`QR de r√©cup√©ration scann√© ! ${e(Q).length} chunks manquants d√©tect√©s.`);return}}catch{}}}catch(r){console.error("Erreur de scan zbar:",r)}}requestAnimationFrame(ve)}}function Z(){s(z,!1),e(S)&&e(S).srcObject&&(e(S).srcObject.getTracks().forEach(t=>t.stop()),e(S).srcObject=null)}function He(){X(),Z(),s(c,null),s(_,[],!0),s(u,""),s(h,0),s(E,""),s(C,[],!0),s(I,""),s(Q,[],!0),s(F,"all"),G.clear()}async function De(t){s(c,t.target.files[0],!0),e(c)&&(await oe(),await L(),W?.focus())}Me(()=>{K()}),Me(()=>{e(k)&&(H=e(k).getContext("2d"))});var de=Ut(),fe=i(de),he=o(i(fe),2),Ie=o(i(he),2);Ie.__change=De;var _e=o(he,2);{var Le=t=>{var r=zt(),n=i(r),v=o(i(n)),l=i(v),d=o(v),x=o(n,2),te=o(i(x)),dt=i(te);A(ft=>{w(l,e(c).name),w(d,` (${ft??""} kB ‚Üí ${e(T)??""} chunks)`),w(dt,`sha256:${e(u)??""}`)},[()=>Math.round(e(c).size/1e3)]),y(t,r)};R(_e,t=>{e(c)&&t(Le)})}var $e=o(_e,2),je=o(i($e),2),me=i(je),Be=o(i(me),2),pe=o(me,2),Ne=o(i(pe),2),ye=o(pe,2),be=o(i(ye),2),j=i(be),Ue=i(j);j.value=j.__value="L";var B=o(j),Pe=i(B);B.value=B.__value="M";var N=o(B),Ve=i(N);N.value=N.__value="Q";var ee=o(N),Je=i(ee);ee.value=ee.__value="H";var Ge=o(ye,2),U=o(i(Ge),2),We=o(U,2),Ye=i(We),ge=o(fe,2),ke=i(ge);{var Ke=t=>{var r=Ft();Qt(r,21,()=>e(C),Mt,(n,v,l)=>{var d=Tt();d.__click=X;var x=i(d);V(x,"alt",`QR Code ${l+1}`),A(()=>V(x,"src",e(v))),y(n,d)}),y(t,r)},Xe=t=>{var r=Ae(),n=ae(r);{var v=l=>{var d=Ot();d.__click=ie;var x=i(d);re(d,te=>W=te,()=>W),A(()=>V(x,"src",e(I))),y(l,d)};R(n,l=>{e(I)&&l(v)},!0)}y(t,r)};R(ke,t=>{e(C).length>0?t(Ke):t(Xe,!1)})}var Ze=o(ke,2),Se=i(Ze),et=i(Se);{var tt=t=>{var r=Dt(),n=ae(r),v=o(n);{var l=d=>{var x=Ht();y(d,x)};R(v,d=>{e(F)==="recovery"&&d(l)})}A(d=>w(n,`Transmission in progress... Chunks ${e(h)-e(D)+1} - ${d??""}
          /
          ${(e(F)==="recovery"?e(Q).length:e(T))??""} `),[()=>Math.min(e(h),e(F)==="recovery"?e(Q).length:e(T))]),y(t,r)},at=t=>{var r=Ae(),n=ae(r);{var v=l=>{var d=wt(`üì± QR code d'information - Scannez-le d'abord pour pr√©parer la
          r√©ception`);y(l,d)};R(n,l=>{e(I)&&l(v)},!0)}y(t,r)};R(et,t=>{e(p)?t(tt):t(at,!1)})}var Ce=o(Se,2);{var rt=t=>{var r=It();r.__click=X,y(t,r)},st=t=>{var r=Lt();r.__click=ie,A(()=>r.disabled=!e(c)),y(t,r)};R(Ce,t=>{e(p)?t(rt):t(st,!1)})}var nt=o(Ce,2);nt.__click=He;var lt=o(ge,2),xe=o(i(lt),4);{var ot=t=>{var r=$t();r.__click=ue,A(()=>r.disabled=!e(c)),y(t,r)},it=t=>{var r=jt();r.__click=Z,y(t,r)};R(xe,t=>{e(z)?t(it,!1):t(ot)})}var we=o(xe,2);{var ct=t=>{var r=Bt(),n=i(r);re(n,l=>s(S,l),()=>e(S));var v=o(n,2);re(v,l=>s(k,l),()=>e(k)),y(t,r)};R(we,t=>{e(z)&&t(ct)})}var ut=o(we,2);{var vt=t=>{var r=Nt(),n=i(r);A(()=>w(n,`‚ö† ${e(Q).length??""} chunks to retransmit`)),y(t,r)};R(ut,t=>{e(Q).length>0&&t(vt)})}A((t,r)=>{w(Ue,`L (7% - Max ${b.L-250} bytes)`),w(Pe,`M (15% - Max ${b.M-250} bytes)`),w(Ve,`Q (25% - Max ${b.Q-250} bytes)`),w(Je,`H (30% - Max ${b.H-250} bytes)`),V(U,"max",t),w(Ye,`Max: ${r??""} bytes for ${e(O)??""} level`)},[Y,Y]),se(Be,()=>e(D),t=>s(D,t)),se(Ne,()=>e(J),t=>s(J,t)),Et(be,()=>e(O),t=>s(O,t)),Ct("blur",U,K),se(U,()=>e(M),t=>s(M,t)),y(a,de),xt()}kt(["change","click"]);Rt(Pt,{target:document.body});
