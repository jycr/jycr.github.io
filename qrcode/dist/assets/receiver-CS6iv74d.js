import{h as xe,j as Se,n as T,k as f,o as Ae,x as e,f as z,q as s,v as r,a as _,z as Qe,A as l,E as te,w as N,B as b,g as ae,F as Ue,m as Ee}from"./disclose-version-D1SOqajz.js";import{i as R,b as se,Q as je,j as De,s as He}from"./jsQR-Di8IMrsB.js";function Fe(m,E){return m==null?null:String(m)}function Ie(m,E,i,o){var y=m.__style;if(y!==E){var u=Fe(E);u==null?m.removeAttribute("style"):m.style.cssText=u,m.__style=E}return o}var Oe=z('<button class="primary svelte-l4z3uq">üì∑ Start Scanning</button>'),Le=z('<button class="danger svelte-l4z3uq">‚èπ Stop Scanning</button>'),$e=z('<div class="scanner-view svelte-l4z3uq"><video autoplay playsinline="" class="svelte-l4z3uq"></video> <canvas style="display:none;"></canvas> <div class="scanner-overlay svelte-l4z3uq"><div class="scanner-frame svelte-l4z3uq"></div></div></div>',2),Te=z('<div class="success-message svelte-l4z3uq">‚úì All chunks have been received!</div>'),Me=z('<div class="card svelte-l4z3uq"><h2 class="svelte-l4z3uq">2. Reception Progress</h2> <div class="file-info"><p class="svelte-l4z3uq"><strong>Fichier:</strong> </p> <p class="svelte-l4z3uq"><strong>Hash:</strong> <code class="svelte-l4z3uq"> </code></p></div> <div class="progress-section svelte-l4z3uq"><div class="progress-bar svelte-l4z3uq"><div class="progress-fill svelte-l4z3uq"></div></div> <p class="progress-text svelte-l4z3uq"> </p></div> <div class="stats svelte-l4z3uq"><div class="stat-item svelte-l4z3uq"><span class="stat-label svelte-l4z3uq">Total scanned:</span> <span class="stat-value svelte-l4z3uq"> </span></div> <div class="stat-item svelte-l4z3uq"><span class="stat-label svelte-l4z3uq">Duplicates:</span> <span class="stat-value svelte-l4z3uq"> </span></div> <div class="stat-item svelte-l4z3uq"><span class="stat-label svelte-l4z3uq">Errors:</span> <span class="stat-value svelte-l4z3uq"> </span></div></div> <!></div>'),Pe=z('<div class="recovery-section svelte-l4z3uq"><p class="info svelte-l4z3uq"><strong> </strong> <!></p> <div class="qr-display svelte-l4z3uq"><img alt="QR Code de r√©cup√©ration" class="svelte-l4z3uq"/> <p class="qr-caption svelte-l4z3uq">Scan this QR with the sender page to retransmit missing chunks</p></div></div>'),Be=z('<div class="card svelte-l4z3uq"><h2 class="svelte-l4z3uq">3. Missing chunks recovery</h2> <p class="svelte-l4z3uq">If chunks are missing, generate a recovery QR code to scan with the sender.</p> <button class="svelte-l4z3uq">üîÑ Generate Recovery QR</button> <!></div>'),Ne=z('<div class="card svelte-l4z3uq"><h2 class="svelte-l4z3uq">4. Download file</h2> <button class="download-button svelte-l4z3uq"> </button></div>'),Ge=z('<main class="svelte-l4z3uq"><h1 class="svelte-l4z3uq">üì• QR Code Receiver</h1> <div class="card svelte-l4z3uq"><h2 class="svelte-l4z3uq">1. Scan QR codes</h2> <div class="controls svelte-l4z3uq"><!> <button class="secondary svelte-l4z3uq">üîÑ Reset</button></div> <!></div> <!> <!> <!></main>');function Je(m,E){Se(E,!0);let i=f(void 0),o=f(void 0),y,u=f(!1),x=T(new Map),c=f(null),I=f(""),q=f(""),h=f(0),j=f(0),k=f(T([])),re=f(T(Date.now())),w=f(T({totalScanned:0,duplicates:0,errors:0})),G=te(()=>e(h)>0?e(j)/e(h)*100:0),M=te(()=>e(h)>0&&e(j)===e(h));async function le(){if(l(u,!0),await ae(),await ae(),await new Promise(t=>setTimeout(t,50)),!e(i)){alert("Video element not ready. Please try again."),l(u,!1);return}if(e(o)&&!y&&(y=e(o).getContext("2d",{willReadFrequently:!0})),!y){alert("Canvas not ready. Please try again."),l(u,!1);return}try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});e(i).srcObject=t,e(i).play(),requestAnimationFrame(J)}catch(t){console.error("Camera access error:",t),alert("Unable to access camera. Please allow camera access."),l(u,!1)}}function O(){l(u,!1),e(i)&&e(i).srcObject&&(e(i).srcObject.getTracks().forEach(t=>t.stop()),e(i).srcObject=null)}function J(){if(!(!e(u)||!y)){if(e(i).readyState===e(i).HAVE_ENOUGH_DATA){e(o).height=e(i).videoHeight,e(o).width=e(i).videoWidth,y.drawImage(e(i),0,0,e(o).width,e(o).height);const t=y.getImageData(0,0,e(o).width,e(o).height),a=De(t.data,t.width,t.height,{inversionAttempts:"dontInvert"});a&&ne(a.data)}requestAnimationFrame(J)}}function ne(t){e(w).totalScanned++;try{const a=JSON.parse(t);if(!a.fileHash||a.chunkIndex===void 0||!a.data){e(w).errors++;return}if(e(c)||(l(c,{hash:a.fileHash,name:a.fileName,totalChunks:a.totalChunks},!0),l(h,a.totalChunks,!0)),a.fileHash!==e(c).hash){console.warn("Chunk d'un autre fichier d√©tect√©");return}if(x.has(a.chunkIndex)){e(w).duplicates++;return}x.set(a.chunkIndex,a.data),l(j,x.size,!0),l(re,Date.now(),!0),console.log(`Chunk ${a.chunkIndex+1}/${e(h)} re√ßu`),e(j)===e(h)&&ie()}catch(a){e(w).errors++,console.error("Erreur de traitement du QR code:",a)}}async function ie(){console.log("Assemblage du fichier...");try{const t=[];for(let n=0;n<e(h);n++){if(!x.has(n)){console.error(`Chunk ${n} manquant`);return}t.push(x.get(n))}const a=t.map(n=>{const g=atob(n),D=new Uint8Array(g.length);for(let C=0;C<g.length;C++)D[C]=g.charCodeAt(C);return D}),v=a.reduce((n,g)=>n+g.length,0),d=new Uint8Array(v);let p=0;for(const n of a)d.set(n,p),p+=n.length;const S=await crypto.subtle.digest("SHA-256",d),A=Array.from(new Uint8Array(S)).map(n=>n.toString(16).padStart(2,"0")).join("");if(A!==e(c).hash){alert("‚ö† Erreur: Le hash du fichier ne correspond pas !"),console.error("Hash attendu:",e(c).hash),console.error("Hash calcul√©:",A);return}const Q=new Blob([d]);l(q,URL.createObjectURL(Q),!0),console.log("‚úì Fichier assembl√© avec succ√®s !"),O()}catch(t){console.error("Erreur lors de l'assemblage du fichier:",t),alert("Erreur lors de l'assemblage du fichier")}}async function oe(){l(k,[],!0);for(let a=0;a<e(h);a++)x.has(a)||e(k).push(a);if(e(k).length===0){alert("All chunks have been received!");return}const t={type:"recovery",fileHash:e(c).hash,missingChunks:e(k)};try{l(I,await je.toDataURL(JSON.stringify(t),{errorCorrectionLevel:"M",margin:1,width:400}),!0)}catch(a){console.error("Erreur lors de la g√©n√©ration du QR de r√©cup√©ration:",a)}}function ce(){if(!e(q))return;const t=document.createElement("a");t.href=e(q),t.download=e(c).name||"fichier_recu",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function ve(){O(),x.clear(),l(c,null),l(I,""),l(q,""),l(h,0),l(j,0),l(k,[],!0),l(w,{totalScanned:0,duplicates:0,errors:0},!0),e(q)&&URL.revokeObjectURL(e(q))}Ae(()=>(e(o)&&(y=e(o).getContext("2d",{willReadFrequently:!0})),()=>{O(),e(q)&&URL.revokeObjectURL(e(q))}));var V=Ge(),W=s(r(V),2),K=s(r(W),2),X=r(K);{var de=t=>{var a=Oe();a.__click=le,_(t,a)},ue=t=>{var a=Le();a.__click=O,_(t,a)};R(X,t=>{e(u)?t(ue,!1):t(de)})}var he=s(X,2);he.__click=ve;var fe=s(K,2);{var pe=t=>{var a=$e(),v=r(a);se(v,p=>l(i,p),()=>e(i));var d=s(v,2);se(d,p=>l(o,p),()=>e(o)),_(t,a)};R(fe,t=>{e(u)&&t(pe)})}var Y=s(W,2);{var ge=t=>{var a=Me(),v=s(r(a),2),d=r(v),p=s(r(d)),S=s(d,2),H=s(r(S),2),A=r(H),Q=s(v,2),n=r(Q),g=r(n),D=s(n,2),C=r(D),L=s(Q,2),$=r(L),U=s(r($),2),P=r(U),ee=s($,2),qe=s(r(ee),2),be=r(qe),ze=s(ee,2),ke=s(r(ze),2),we=r(ke),Ce=s(L,2);{var Re=F=>{var B=Te();_(F,B)};R(Ce,F=>{e(M)&&F(Re)})}N((F,B)=>{b(p,` ${e(c).name??""}`),b(A,`${F??""}...`),Ie(g,`width: ${e(G)??""}%`),b(C,`${e(j)??""} / ${e(h)??""} chunks received (${B??""}%)`),b(P,e(w).totalScanned),b(be,e(w).duplicates),b(we,e(w).errors)},[()=>e(c).hash.substring(0,16),()=>e(G).toFixed(1)]),_(t,a)};R(Y,t=>{e(c)&&t(ge)})}var Z=s(Y,2);{var _e=t=>{var a=Be(),v=s(r(a),4);v.__click=oe;var d=s(v,2);{var p=S=>{var H=Pe(),A=r(H),Q=r(A),n=r(Q),g=s(Q),D=s(g);{var C=U=>{var P=Ue("...");_(U,P)};R(D,U=>{e(k).length>10&&U(C)})}var L=s(A,2),$=r(L);N(U=>{b(n,e(k).length),b(g,` missing chunk(s):
						${U??""} `),He($,"src",e(I))},[()=>e(k).slice(0,10).join(", ")]),_(S,H)};R(d,S=>{e(I)&&S(p)})}_(t,a)};R(Z,t=>{e(c)&&!e(M)&&t(_e)})}var me=s(Z,2);{var ye=t=>{var a=Ne(),v=s(r(a),2);v.__click=ce;var d=r(v);N(()=>b(d,`üíæ Download ${e(c).name??""}`)),_(t,a)};R(me,t=>{e(M)&&e(q)&&t(ye)})}_(m,V),Qe()}xe(["click"]);Ee(Je,{target:document.getElementById("app")});
