import{l as ge,c as R,b as Ye,t as Ke,i as Xe,s as Ze,d as et,p as ke,g as tt,u as at,r as rt,h as st,j as lt,k as _,n as Y,o as me,f as k,q as n,v as c,w as Q,x as e,y as nt,a as g,z as it,A as l,B as x,C as ct,D as ot,m as vt}from"./disclose-version-D1SOqajz.js";import{i as M,s as pe,b as ye,Q as ut,j as dt}from"./jsQR-Di8IMrsB.js";function Se(a,v,h=!1){if(a.multiple){if(v==null)return;if(!Xe(v))return Ze();for(var i of a.options)i.selected=v.includes(z(i));return}for(i of a.options){var u=z(i);if(et(u,v)){i.selected=!0;return}}(!h||v!==void 0)&&(a.selectedIndex=-1)}function ft(a){var v=new MutationObserver(()=>{Se(a,a.__value)});v.observe(a,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ke(()=>{v.disconnect()})}function _t(a,v,h=v){var i=new WeakSet,u=!0;ge(a,"change",o=>{var f=o?"[selected]":":checked",d;if(a.multiple)d=[].map.call(a.querySelectorAll(f),z);else{var S=a.querySelector(f)??a.querySelector("option:not([disabled])");d=S&&z(S)}h(d),R!==null&&i.add(R)}),Ye(()=>{var o=v();if(a===document.activeElement){var f=ke??R;if(i.has(f))return}if(Se(a,o,u),u&&o===void 0){var d=a.querySelector(":checked");d!==null&&(o=z(d),h(o))}a.__value=o,u=!1}),ft(a)}function z(a){return"__value"in a?a.__value:a.value}function be(a,v,h=v){var i=new WeakSet;ge(a,"input",async u=>{var o=u?a.defaultValue:a.value;if(o=K(a)?X(o):o,h(o),R!==null&&i.add(R),await tt(),o!==(o=v())){var f=a.selectionStart,d=a.selectionEnd,S=a.value.length;if(a.value=o??"",d!==null){var m=a.value.length;f===d&&d===S&&m>S?(a.selectionStart=m,a.selectionEnd=m):(a.selectionStart=f,a.selectionEnd=Math.min(d,m))}}}),at(v)==null&&a.value&&(h(K(a)?X(a.value):a.value),R!==null&&i.add(R)),rt(()=>{var u=v();if(a===document.activeElement){var o=ke??R;if(i.has(o))return}K(a)&&u===X(a.value)||a.type==="date"&&!u&&!a.value||u!==a.value&&(a.value=u??"")})}function K(a){var v=a.type;return v==="number"||v==="range"}function X(a){return a===""?null:+a}var ht=k('<div class="file-info"><p class="svelte-1ecl6tu">âœ“ File: <strong> </strong> </p> <p class="svelte-1ecl6tu">Hash: <code class="svelte-1ecl6tu"> </code></p></div>'),mt=k('<button class="primary svelte-1ecl6tu">â–¶ Start Transmission</button>'),pt=k('<button class="danger svelte-1ecl6tu">â¹ Stop</button>'),yt=k('<span class="recovery-mode svelte-1ecl6tu">(Recovery mode)</span>'),bt=k('<div class="qr-display svelte-1ecl6tu"><img alt="QR Code" class="svelte-1ecl6tu"/></div>'),gt=k('<p class="status svelte-1ecl6tu"> <!></p> <!>',1),kt=k('<button class="svelte-1ecl6tu">ğŸ“· Scan Recovery QR</button>'),St=k('<button class="danger svelte-1ecl6tu">â¹ Stop le scan</button>'),xt=k('<div class="scanner-view svelte-1ecl6tu"><video width="400" height="300" style="display:block;" class="svelte-1ecl6tu"></video> <canvas width="400" height="300" style="display:none;"></canvas></div>',2),Ct=k('<p class="info svelte-1ecl6tu"> </p>'),wt=k('<main class="svelte-1ecl6tu"><h1 class="svelte-1ecl6tu">ğŸ“¤ QR Code Sender</h1> <div class="card svelte-1ecl6tu"><p class="field svelte-1ecl6tu"><label for="fileInput" class="svelte-1ecl6tu">Select a file</label> <input id="fileInput" type="file" accept="*/*" class="svelte-1ecl6tu"/></p> <!> <details><summary>Transmission Parameters (advanced options)</summary> <div class="settings svelte-1ecl6tu"><p class="field svelte-1ecl6tu"><label for="transmissionSpeed" class="svelte-1ecl6tu">Transmission speed (ms):</label> <input id="transmissionSpeed" type="number" min="100" max="5000" step="50" class="svelte-1ecl6tu"/></p> <p class="field svelte-1ecl6tu"><label for="errorCorrectionLevel" class="svelte-1ecl6tu">Error correction level:</label> <select id="errorCorrectionLevel" class="svelte-1ecl6tu"><option> </option><option> </option><option> </option><option> </option></select></p> <p class="field svelte-1ecl6tu"><label for="chunkSize" class="svelte-1ecl6tu">Chunk size (bytes):</label> <input id="chunkSize" type="number" min="500" step="100" class="svelte-1ecl6tu"/> <span class="tips svelte-1ecl6tu"> </span></p></div></details> <div class="controls svelte-1ecl6tu"><!> <button class="secondary svelte-1ecl6tu">ğŸ”„ Reset</button></div> <!></div> <div class="card svelte-1ecl6tu"><h2 class="svelte-1ecl6tu">Missing chunks recovery</h2> <p class="svelte-1ecl6tu">Scan the recovery QR code displayed by the receiver</p> <!> <!> <!></div></main>');function Mt(a,v){lt(v,!0);const h={L:2953,M:2331,Q:1663,H:1273};let i=_(null),u=_(Y([])),o=_(""),f=_(!1),d=_(0),S=_(""),m=_(void 0),p=_(void 0),D,E=_(!1),C=_(Y([])),T=_("all"),A=_(1400),U=_(100),F=_("M"),q=_(0),N=Y(new Set);function J(){return h[e(F)]-250}function P(){const t=J();e(A)>t&&(l(A,t,!0),alert(`Chunk size adjusted to ${t} bytes to fit in QR code with ${e(F)} error correction.`))}async function xe(t){const r=await t.arrayBuffer(),s=await crypto.subtle.digest("SHA-256",r);return Array.from(new Uint8Array(s)).map(b=>b.toString(16).padStart(2,"0")).join("")}async function Z(){if(!e(i))return;l(o,await xe(e(i)),!0);const t=await e(i).arrayBuffer(),r=new Uint8Array(t);l(u,[],!0),l(q,Math.ceil(r.length/e(A)),!0);for(let s=0;s<e(q);s++){const y=s*e(A),b=Math.min(y+e(A),r.length),$=r.slice(y,b),j=btoa(String.fromCharCode(...$));e(u).push({fileHash:e(o),fileName:e(i).name,chunkIndex:s,totalChunks:e(q),data:j})}}async function Ce(){P(),e(u).length===0&&await Z(),l(f,!0),l(d,0),N.clear(),ee()}async function ee(){if(!e(f))return;let t=[];if(e(T)==="recovery"&&e(C).length>0?t=e(C).map(s=>e(u)[s]).filter(Boolean):t=e(u),t.length===0){l(f,!1);return}if(e(d)>=t.length){l(f,!1),ae();return}const r=t[e(d)];try{const s=JSON.stringify(r);l(S,await ut.toDataURL(s,{errorCorrectionLevel:e(F),margin:1,width:600,color:{dark:"#000000",light:"#FFFFFF"}}),!0),N.add(r.chunkIndex),ot(d),setTimeout(ee,e(U))}catch(s){console.error("Error generating QR code:",s),alert(`Error generating QR code: ${s.message}

Try reducing the chunk size or changing the error correction level.`),l(f,!1)}}function te(){l(f,!1)}async function ae(){l(E,!0);try{const t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});e(p).srcObject=t,e(p).play(),requestAnimationFrame(re)}catch(t){console.error("Erreur d'accÃ¨s Ã  la camÃ©ra:",t),alert("Impossible d'accÃ©der Ã  la camÃ©ra"),l(E,!1)}}function re(){if(e(E)){if(e(p).readyState===e(p).HAVE_ENOUGH_DATA){D.drawImage(e(p),0,0,e(m).width,e(m).height);const t=D.getImageData(0,0,e(m).width,e(m).height),r=dt(t.data,t.width,t.height);if(r)try{const s=JSON.parse(r.data);if(s.type==="recovery"&&s.fileHash===e(o)){l(C,s.missingChunks,!0),V(),l(T,"recovery"),alert(`QR de rÃ©cupÃ©ration scannÃ© ! ${e(C).length} chunks manquants dÃ©tectÃ©s.`);return}}catch{}}requestAnimationFrame(re)}}function V(){l(E,!1),e(p)&&e(p).srcObject&&(e(p).srcObject.getTracks().forEach(t=>t.stop()),e(p).srcObject=null)}function we(){te(),V(),l(i,null),l(u,[],!0),l(o,""),l(d,0),l(S,""),l(C,[],!0),l(T,"all"),N.clear()}function Me(t){l(i,t.target.files[0],!0),e(i)&&Z()}me(()=>{P()}),me(()=>{e(m)&&(D=e(m).getContext("2d"))});var se=wt(),le=n(c(se),2),ne=c(le),Re=n(c(ne),2);Re.__change=Me;var ie=n(ne,2);{var Ae=t=>{var r=ht(),s=c(r),y=n(c(s)),b=c(y),$=n(y),j=n(s,2),G=n(c(j)),w=c(G);Q(H=>{x(b,e(i).name),x($,` (${H??""} kB
					â†’ ${e(q)??""} chunks)`),x(w,`sha256:${e(o)??""}`)},[()=>Math.round(e(i).size/1e3)]),g(t,r)};M(ie,t=>{e(i)&&t(Ae)})}var ce=n(ie,2),Qe=n(c(ce),2),oe=c(Qe),Ee=n(c(oe),2),ve=n(oe,2),ue=n(c(ve),2),I=c(ue),Te=c(I);I.value=I.__value="L";var L=n(I),Fe=c(L);L.value=L.__value="M";var O=n(L),qe=c(O);O.value=O.__value="Q";var W=n(O),He=c(W);W.value=W.__value="H";var $e=n(ve,2),B=n(c($e),2),je=n(B,2),ze=c(je),de=n(ce,2),fe=c(de);{var Ie=t=>{var r=mt();r.__click=Ce,Q(()=>r.disabled=!e(i)),g(t,r)},Le=t=>{var r=pt();r.__click=te,g(t,r)};M(fe,t=>{e(f)?t(Le,!1):t(Ie)})}var Oe=n(fe,2);Oe.__click=we;var Be=n(de,2);{var De=t=>{var r=gt(),s=ct(r),y=c(s),b=n(y);{var $=w=>{var H=yt();g(w,H)};M(b,w=>{e(T)==="recovery"&&w($)})}var j=n(s,2);{var G=w=>{var H=bt(),Ge=c(H);Q(()=>pe(Ge,"src",e(S))),g(w,H)};M(j,w=>{e(S)&&w(G)})}Q(()=>x(y,`Transmission in progress...
				Chunk ${e(d)%(e(T)==="recovery"?e(C).length:e(q))+1}
				/
				${(e(T)==="recovery"?e(C).length:e(q))??""} `)),g(t,r)};M(Be,t=>{e(f)&&t(De)})}var Ue=n(le,2),_e=n(c(Ue),4);{var Ne=t=>{var r=kt();r.__click=ae,Q(()=>r.disabled=!e(i)),g(t,r)},Je=t=>{var r=St();r.__click=V,g(t,r)};M(_e,t=>{e(E)?t(Je,!1):t(Ne)})}var he=n(_e,2);{var Pe=t=>{var r=xt(),s=c(r);ye(s,b=>l(p,b),()=>e(p));var y=n(s,2);ye(y,b=>l(m,b),()=>e(m)),g(t,r)};M(he,t=>{e(E)&&t(Pe)})}var Ve=n(he,2);{var We=t=>{var r=Ct(),s=c(r);Q(()=>x(s,`âš  ${e(C).length??""} chunks to retransmit`)),g(t,r)};M(Ve,t=>{e(C).length>0&&t(We)})}Q((t,r)=>{x(Te,`L (7% - Max ${h.L-250} bytes)`),x(Fe,`M (15% - Max ${h.M-250} bytes)`),x(qe,`Q (25% - Max ${h.Q-250} bytes)`),x(He,`H (30% - Max ${h.H-250} bytes)`),pe(B,"max",t),x(ze,`Max: ${r??""} bytes for ${e(F)??""} level`)},[J,J]),be(Ee,()=>e(U),t=>l(U,t)),_t(ue,()=>e(F),t=>l(F,t)),nt("blur",B,P),be(B,()=>e(A),t=>l(A,t)),g(a,se),it()}st(["change","click"]);vt(Mt,{target:document.getElementById("app")});
