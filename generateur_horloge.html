<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8" />
    <title>Horloges</title>
    <style>
        .card input::-webkit-outer-spin-button,
        .card input::-webkit-inner-spin-button {
            /* Chrome, Safari, Edge, Opera */
            -webkit-appearance: none;
            margin: 0;
        }
        
        .card input[type=number] {
            /* Firefox */
            -moz-appearance: textfield;
        }
        
        body {
            font-family: "Segoe UI", sans-serif;
            text-align: center;
        }
        
        section {
            max-width: 21cm;
            margin: auto;
        }
        
        .card {
            display: inline-block;
            width: 12em;
            margin: 0.3em;
            padding: 0.5em;
            background-color: #FFF;
            border: 1px solid #AAA;
        }
        
        p {
            margin: 0
        }
        
        circle {
            fill: none;
            stroke-width: 2;
        }
        
        .exterieur {
            stroke-width: 0.5;
            stroke: #AAA;
            r: 39px;
        }
        
        .exterieur2 {
            stroke-width: 0.5;
            stroke: #AAA;
            r: 49px;
        }
        
        .centre {
            fill: #000;
            r: 2px;
        }
        
        path {
            stroke: #000000;
            stroke-width: 1px;
        }
        
        .quart {
            stroke-width: 2.5px;
            stroke-linecap: round;
        }
        
        .soixantieme {
            stroke-width: 0.3px;
            stroke-linecap: round;
        }
        
        .sixieme {
            stroke-width: 1px;
            stroke-linecap: round;
        }
        
        .aiguille_seconde {
            stroke-width: 0.2;
            stroke-linecap: round;
        }
        
        .aiguille_minute {
            stroke-width: 2;
            stroke-linecap: round;
            stroke: #00F;
        }
        
        .aiguille_heure {
            stroke-width: 3;
            stroke-linecap: round;
            stroke: #F00;
        }
        
        .afficher_secondes .aiguille_seconde {
            display: unset;
        }
        
        .aiguille_seconde {
            display: none;
        }
        
        .masquer_aiguilles .aiguille_seconde,
        .masquer_aiguilles .aiguille_minute,
        .masquer_aiguilles .aiguille_heure {
            display: none;
        }
        
        .reponse input {
            border: none;
            border-bottom: 1px dotted #BBB;
            width: 2em;
        }
        
        .card input {
            color: transparent;
            font-family: inherit;
            font-size: inherit;
            font-weight: bold;
        }
        
        .card input:focus {
            color: #000;
        }
        
        .card input[type=number] {
            text-align: right;
            width: 1.2em;
        }
        
        .reponse input[name="horaire-simple"] {
            width: 100%;
            font-style: italic;
            text-align: center;
            visibility: hidden;
            font-weight: normal;
            font-family: serif;
        }
        
        .masquer_aiguilles .card input[type=number],
        .masquer_aiguilles .card input[name="horaire-simple"] {
            color: #000;
        }
        
        .masquer_aiguilles .time-matin .apres-midi,
        .masquer_aiguilles .time-apres-midi .matin {
            opacity: 0;
        }
        
        .horaire-simple .reponse input[name="horaire-simple"] {
            visibility: visible;
        }
        
        .chiffre {
            dominant-baseline: middle;
            text-anchor: middle;
            font-family: 'Segoe UI', sans-serif;
            font-size: 9px;
            font-weight: bold;
        }
        
        header {
            position: fixed;
            background-color: #FFF;
            top: 0;
            left: 0;
            right: 0;
            height: 1.5em;
            border-bottom: 1px solid #000;
        }
        
        section {
            margin-top: 2em;
        }
        
        @media print {
            header {
                display: none;
            }
            section {
                margin-top: 0;
            }
        }
        
        .reponse.secondes {
            display: none;
        }
        
        .zone_reponse {
            text-align: right;
        }
        
        .zone_reponse fieldset {
            border: none;
            padding: 0;
            margin: 0.5em 0;
        }
        
        .zone_reponse legend {
            text-overflow: ellipsis;
            width: 5.2em;
            white-space: nowrap;
            float: left;
        }
        
        .afficher_secondes .reponse.secondes {
            display: inline;
        }
        
        .afficher_secondes .zone_reponse {
            font-size: 0.8em;
        }
    </style>
</head>

<body>
    <header>
        <p>
            <label><input type="checkbox" name="afficher_aiguilles" checked /> Afficher les aiguilles</label>
            <label><input type="checkbox" name="afficher_secondes" /> Afficher les secondes</label>
        </p>
    </header>
    <section>
        <div class="card">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" viewBox="0 0 100 100">
				<g transform="translate(50,50)">
					<circle class="exterieur2" />
					<circle class="exterieur" />
					<path class="aiguille_seconde" d="m0,0v-31" />
					<path class="aiguille_minute" d="m0,0v-28" />
					<path class="aiguille_heure" d="m0,0v-16" />
					<g id="graduation_quart">
						<path class="trait_graduation quart" d="M0,38v-5" />
						<g id="graduation_sixieme_detaillee">
							<path class="soixantieme" d="M0,36v-4" id="graduation_soixantieme" transform="rotate(6)" />
							<use transform="rotate(6)" xlink:href="#graduation_soixantieme" />
							<use transform="rotate(12)" xlink:href="#graduation_soixantieme" />
							<use transform="rotate(18)" xlink:href="#graduation_soixantieme" />
						</g>
						<g id="graduation_sixieme">
							<path class="sixieme" d="M0,38v-6" transform="rotate(30)" />
							<use transform="rotate(30)" xlink:href="#graduation_sixieme_detaillee" />
						</g>
						<use transform="rotate(30)" xlink:href="#graduation_sixieme" />
					</g>
					<use transform="rotate(90)" xlink:href="#graduation_quart" />
					<use transform="rotate(180)" xlink:href="#graduation_quart" />
					<use transform="rotate(270)" xlink:href="#graduation_quart" />
					<g transform="translate(0,1)" class="chiffre">
						<text style="transform:rotate(360deg) translate(0,-44.5px) rotate(-360deg) ">12</text>
						<text style="transform:rotate(330deg) translate(0,-44.5px) rotate(-330deg) ">11</text>
						<text style="transform:rotate(300deg) translate(0,-44.5px) rotate(-300deg) ">10</text>
						<text style="transform:rotate(270deg) translate(0,-44.5px) rotate(-270deg) ">9</text>
						<text style="transform:rotate(240deg) translate(0,-44.5px) rotate(-240deg) ">8</text>
						<text style="transform:rotate(210deg) translate(0,-44.5px) rotate(-210deg) ">7</text>
						<text style="transform:rotate(180deg) translate(0,-44.5px) rotate(-180deg) ">6</text>
						<text style="transform:rotate(150deg) translate(0,-44.5px) rotate(-150deg) ">5</text>
						<text style="transform:rotate(120deg) translate(0,-44.5px) rotate(-120deg) ">4</text>
						<text style="transform:rotate(90deg)  translate(0,-44.5px) rotate(-90deg)  ">3</text>
						<text style="transform:rotate(60deg)  translate(0,-44.5px) rotate(-60deg)  ">2</text>
						<text style="transform:rotate(30deg)  translate(0,-44.5px) rotate(-30deg)  ">1</text>
					</g>
					<circle class="centre" r="1" />
				</g>
			</svg>
            <div class="zone_reponse">
                <fieldset class="matin">
                    <legend>matin :</legend>
                    <label class="reponse"><input type="number" min="0" max="11" step="1" />h</label>
                    <label class="reponse"><input type="number" min="0" max="59" step="1" />min</label>
                    <label class="reponse secondes"><input type="number" min="0" max="59" step="1" />sec</label>
                    <div class="reponse"><input type="text" name="horaire-simple" value="" readonly /></div>
                </fieldset>
                <fieldset class="apres-midi">
                    <legend>après-midi :</legend>
                    <label class="reponse"><input type="number" min="12" max="23" step="1" />h</label>
                    <label class="reponse"><input type="number" min="0" max="59" step="1" />min</label>
                    <label class="reponse secondes"><input type="number" min="0" max="59" step="1" />sec</label>
                    <div class="reponse"><input type="text" name="horaire-simple" value="" readonly /></div>
                </fieldset>
            </div>
        </div>
    </section>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha256-pasqAKBDmFT4eHoN2ndd6lN370kFiGUFyTiUHWhU7k8=" crossorigin="anonymous"></script>
    <script>
        (function($) {
            function randomBoolean() {
                return Math.round(Math.random()) === 0;
            }

            function randomInteger(maxParam, minParam) {
                minParam = minParam || 0;
                const max = Math.max(maxParam, minParam);
                const min = Math.min(maxParam, minParam);
                return Math.round(Math.random() * (max - min)) + min;
            }

            function paddingZero(value) {
                return (value > 9 ? "" : "0") + value;
            }

            function randomIntegerStringWith2Digits(maxParam, minParam) {
                return paddingZero(randomInteger(maxParam, minParam))
            }

            function rotate($element, value, transposeFunction) {
                if (isNaN(value)) {
                    value = 0;
                }
                const angle = transposeFunction(value);
                $element.attr('transform', 'rotate(' + angle + ')');
                return value;
            }

            function updateTimeInInputs($zone, timeArray) {
                const matin = $zone.hasClass('matin');
                const $inputs = $zone.find('input[type=number]');
                let heures = timeArray[0];
                if (matin && heures >= 12) {
                    heures = heures - 12;
                } else if (!matin && heures < 12) {
                    heures = heures + 12;
                }
                const minutes = timeArray[1];
                const secondes = isNaN(timeArray[2]) ? 0 : timeArray[2];
                $inputs.get(0).value = heures;
                $inputs.get(1).value = minutes;
                $inputs.get(2).value = secondes;
                $zone.find('input[name="horaire-simple"]').val(toLibelle(heures, minutes, secondes));
            }

            function updateTimeForCard($card) {
                const $aiguilleSeconde = $card.find(".aiguille_seconde");
                const $aiguilleMinute = $card.find(".aiguille_minute");
                const $aiguilleHeure = $card.find(".aiguille_heure");

                const timeArray = ($card.data('time') || '').trim().split((/\D+/)).map(s => parseInt(s, 10));
                const heures = timeArray[0];
                const minutes = timeArray[1];
                let secondes = 0;
                if ($('body').hasClass('afficher_secondes')) {
                    secondes = timeArray[2];
                }
                rotate($aiguilleSeconde, secondes, s => 360 * s / 60);
                rotate($aiguilleMinute, minutes, m => 360 * (secondes + 60 * m) / 3600);
                rotate($aiguilleHeure, heures, h => 360 * (secondes + 60 * minutes + 3600 * h) / 43200);
                updateTimeInInputs($card.find('.matin'), timeArray);
                updateTimeInInputs($card.find('.apres-midi'), timeArray);
                // est-ce un "horaire simple" ?
                const horaireSimple = toLibelle(heures, minutes, secondes);
                $card.toggleClass('horaire-simple', horaireSimple.length > 0);
                $card.toggleClass('time-matin', heures < 12);
                $card.toggleClass('time-apres-midi', heures >= 12);
            }

            function toLibelle(heures, minutes, seconds) {
                if (minutes % 15 !== 0 || seconds !== 0) {
                    return "";
                }
                let minutesStr = "";
                if (minutes === 15) {
                    minutesStr = "un quart";
                } else if (minutes === 30) {
                    minutesStr = "et demi";
                } else if (minutes === 45) {
                    minutesStr = "moins le quart";
                    heures++;
                }
                let indicateurJour = "du matin";
                if (heures > 12) {
                    indicateurJour = heures < 18 ? "de l'après-midi" : "du soir";
                    heures = heures - 12;
                }

                let heureStr = heures + "h";
                if (heures === 12) {
                    heureStr = "midi";
                    indicateurJour = "";
                } else if (heures === 0) {
                    heureStr = "minuit";
                    indicateurJour = "";
                }

                return [
                    heureStr,
                    minutesStr,
                    indicateurJour
                ].join(' ');
            }

            function updateTimeForAllCards() {
                $('.card').each(function() {
                    updateTimeForCard($(this))
                });
            }

            function randomTime() {
                // un "horaire simple", c'est "11 et quart", "midi et demi", etc.
                const horaireSimple = randomBoolean();
                const heures = randomIntegerStringWith2Digits(0, 23);
                let minutes = randomIntegerStringWith2Digits(0, 59);
                let secondes = randomIntegerStringWith2Digits(0, 59);
                if (horaireSimple) {
                    minutes = paddingZero(randomInteger(0, 3) * 15);
                    secondes = paddingZero(0);
                }
                return [heures, minutes, secondes].join(':');
            }

            // Doplication des cartes de propositions
            const $cardTemplate = $(".card");
            for (let i = 0; i < 8; ++i) {
                $cardTemplate.clone().insertAfter($cardTemplate);
            }
            $('.card').each(function() {
                this.dataset.time = randomTime();
            });
            $(document)
                .on('input', 'input[name="afficher_secondes"]', function() {
                    $('body').toggleClass('afficher_secondes', this.checked);
                    updateTimeForAllCards();
                })
                .on('input', 'input[name="afficher_aiguilles"]', function() {
                    $('body').toggleClass('masquer_aiguilles', !this.checked);
                })
                .on('input', 'input[type=number]', function() {
                    const $card = $(this).closest('.card');
                    const $fieldset = $(this).closest('fieldset');
                    const $inputs = $fieldset.find('input[type=number]')
                    $card.data('time', [
                        parseInt($inputs.get(0).value, 10),
                        parseInt($inputs.get(1).value, 10),
                        $('body').hasClass('afficher_secondes') ? parseInt($inputs.get(2).value, 10) : 0,
                    ].join(':'));
                    updateTimeForCard($card);
                });
            updateTimeForAllCards();
        })(jQuery);
    </script>
</body>

</html>